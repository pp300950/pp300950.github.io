<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Project Chimera - รายการลูกค้าล่าสุด</title>
    <style>
        body {
            background: #f0e6d6;
            font-family: 'Courier New', Courier, monospace;
            color: #222;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.6;
        }

        .next-button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #000;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-family: 'Courier New', Courier, monospace;
            text-decoration: none;
            display: inline-block;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: #fff;
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        h1 { text-align:center; font-size:22px; margin-bottom:8px; }
        p.lead { text-align:center; margin-top:0; color:#444; }
        ol.ip-list { padding-left: 18px; margin-top:20px; }
        li.ip-item {
            background:#fbfbfb; border:1px solid #e0e0e0; padding:12px; margin-bottom:8px;
            cursor:pointer; transition:background .15s;
            display:flex; justify-content:space-between; align-items:center;
        }
        li.ip-item:hover { background:#f0f8ff; }
        .meta { font-size:13px; color:#666; }
        .details {
            display:none;
            margin-top:10px;
            padding:12px;
            background:#f6f6f6;
            border-left:4px solid #666;
            font-family: 'Arial Narrow', 'Segoe Print', cursive;
        }
        .details.show { display:block; }
        .notice { margin-top:14px; padding:12px; background:#e6f7ff; border-left:5px solid #007bff; }
        .guess-area { margin-top:20px; text-align:center; }
        input[type="text"]{
            padding:10px 12px; font-size:16px; width:260px; border-radius:6px; border:1px solid #ccc;
        }
        button.go {
            padding:10px 16px; margin-left:10px; font-size:16px; border-radius:6px; border:none; cursor:pointer;
            background:#000; color:#fff; font-family: 'Courier New', Courier, monospace;
        }
        .small { font-size:13px; color:#555; margin-top:8px; }
        @media (max-width:600px){ .container{ padding:16px } input[type="text"]{ width:100% } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ลูกค้าล่าสุดที่เข้าใช้งานเว็บไซต์ที่รวบรวมได้</h1>
        <p class="lead">กดที่รายการเพื่อดูข้อมูล — หาสองไอพีที่มีรูปแบบ เข้าข่ายคล้ายไอพีของผู้ร้ายหรือข้อมูลคล้ายก็ได้ แล้วกรอกหมายเลขผู้ใช้ที่คิดว่าน่าจะเป็นทั้งสอง</p>

        <div class="notice">
            <strong>คำเตือน:</strong> ข้อมูลที่แสดงเป็นข้อมูลสมมติสำหรับภารกิจนี้เท่านั้น — ไม่ใช่ข้อมูลจริง
        </div>

        <ol id="ipList" class="ip-list"></ol>

        <div class="guess-area">
            <div>
                <label for="guess"><strong>กรอกหมายเลขผู้ใช้ที่คิดว่าเป็นไอพีรูปแบบมีเเพทเทิ่น หรือจะอ่านข้อมูลเอาก็ได้ </strong></label><br/>
                <input id="guess" type="text" placeholder="ตัวอย่าง: 2,7 (เรียงอะไรก็ได้)"/>
                <button class="go" id="submitBtn">ค้นหาคีย์การเข้ารหัส</button>
            </div>
            <div class="small">หมายเหตุ: หมายเลขที่ต้องกรอกคือลำดับของรายการ (1 - จำนวนรายการ)</div>
            <a href="evidence.html" class="next-button">กลับไปหน้าก่อนหน้านี้</a>
        </div>
    </div>

    <script>
        // สร้างรายการ IP แบบสุ่ม + บังคับให้มี 2 รายการที่เป็น xxx.x.113.xxx
        function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
        function randIP() {
            return [randInt(1,223), randInt(0,255), randInt(0,255), randInt(1,254)].join('.');
        }

        // ข้อมูลสมมติสำหรับบางไอพี (จะไม่ใช่คนจริง)
        const sampleProfiles = [
            {name: "สมชาย ใจดี", nick: "ชอ", gender: "ชาย", age: 34, address: "123/4 หมู่ 5 ถ.ราษฎร์บริรักษ์, อ.เมือง", country: "ไทย"},
            {name: "สุกัญญา พวงเงิน", nick: "กาญ", gender: "หญิง", age: 28, address: "56 ซ.สุขใจ ถ.สุขุมวิท, ต.บางนา", country: "ไทย"},
            {name: "Alex Mercer", nick: "Merc", gender: "ชาย", age: 41, address: "12 Baker St, Central", country: "UK"},
            {name: "สมควร โดนเเล้ว", nick: "arm", gender: "หญิง", age: 30, address: "No.8 Lane 33, Jing'an", country: "China"},
            {name: "สมควร โดนเเล้ว", nick: "เเขน", gender: "ชาย", age: 30, address: "No.9 Lane 49, Jing'an", country: "China"},
            {name: "Иван Петров", nick: "Ivan", gender: "ชาย", age: 37, address: "ул. Ленина, д.12", country: "Russia"},
            {name: "Kaito Nakamura", nick: "Kai", gender: "ชาย", age: 22, address: "5-3-2 Ginza", country: "Japan"},
            {name: "นัทธมน สายสว่าง", nick: "นัท", gender: "หญิง", age: 19, address: "77 ถ.ช้างคลาน, จ.เชียงใหม่", country: "ไทย"},
            {name: "Carlos Ruiz", nick: "Carl", gender: "ชาย", age: 45, address: "C/ Mayor 10", country: "Spain"},
            {name: "Aisha Khalid", nick: "Aisha", gender: "หญิง", age: 32, address: "Al Noor St.", country: "UAE"}
        ];

        // สร้างรายการทั้งหมด (รวม 10 รายการ) — สุ่มตำแหน่งของ 2 ip แบบ .113.
        const total = 10;
        const forcedIndices = [];
        while (forcedIndices.length < 2) {
            const idx = randInt(0, total-1);
            if (!forcedIndices.includes(idx)) forcedIndices.push(idx);
        }

        const ipEntries = [];
        for (let i=0;i<total;i++){
            let ip;
            if (forcedIndices.includes(i)) {
                // สร้าง ip ที่มี .113 ในตำแหน่งที่ 3 (เช่น xxx.x.113.xxx)
                ip = `${randInt(1,223)}.${randInt(0,255)}.113.${randInt(1,254)}`;
            } else {
                ip = randIP();
            }
            const profile = sampleProfiles[i % sampleProfiles.length];
            // เก็บข้อมูล (สมมติ)
            ipEntries.push({
                ip, profile, time: `2025-09-${randInt(10,19)} ${String(randInt(8,23)).padStart(2,'0')}:${String(randInt(0,59)).padStart(2,'0')}:00`
            });
        }

        // แสดงรายการในหน้า
        const ipList = document.getElementById('ipList');
        ipEntries.forEach((e, idx) => {
            const li = document.createElement('li');
            li.className = 'ip-item';
            li.innerHTML = `
                <div>
                    <strong>ผู้ใช้ #${idx+1}</strong><div class="meta">เวลา: ${e.time}</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-weight:bold">${e.ip}</div>
                    <div class="meta">คลิกเพื่อดูรายละเอียด</div>
                </div>
            `;
            // details panel
            const details = document.createElement('div');
            details.className = 'details';
            details.id = `details-${idx+1}`;
            details.innerHTML = `
                <p><strong>ชื่อ-นามสกุล:</strong> ${e.profile.name}</p>
                <p><strong>ชื่อเล่น:</strong> ${e.profile.nick}</p>
                <p><strong>เพศ:</strong> ${e.profile.gender}</p>
                <p><strong>อายุ:</strong> ${e.profile.age}</p>
                <p><strong>ที่อยู่:</strong> ${e.profile.address}</p>
                <p><strong>ประเทศ:</strong> ${e.profile.country}</p>
                <p class="meta"><em>IP: ${e.ip}</em></p>
            `;
            li.appendChild(details);

            li.addEventListener('click', function(ev){
                // toggle
                const already = details.classList.contains('show');
                // ปิด panel ทั้งหมดก่อน
                document.querySelectorAll('.details').forEach(d=>d.classList.remove('show'));
                document.querySelectorAll('.ip-item').forEach(it=>it.classList.remove('active'));
                if (!already) {
                    details.classList.add('show');
                    li.classList.add('active');
                }
            });

            ipList.appendChild(li);
        });

        // เตรียมค่าตอบถูก (index เรียงจาก 1)
        const correctIndices = forcedIndices.map(i => i+1).sort((a,b)=>a-b);

        // รับคำตอบผู้เล่น
        document.getElementById('submitBtn').addEventListener('click', function(){
            const raw = document.getElementById('guess').value.trim();
            if (!raw) { alert('กรุณากรอกหมายเลขที่คิดว่าเป็น (เช่น 2,7)'); return; }
            // แยกค่า, แปลงเป็นตัวเลข, ลบช่องว่าง, ลำดับ
            const parts = raw.split(',').map(s=>s.trim()).filter(s=>s!=='');
            const nums = [];
            for (let p of parts) {
                const v = Number(p);
                if (!Number.isInteger(v) || v < 1 || v > total) {
                    alert('รูปแบบคำตอบไม่ถูกต้อง หรือมีหมายเลขอยู่นอกช่วง 1-'+total);
                    return;
                }
                if (!nums.includes(v)) nums.push(v);
            }
            nums.sort((a,b)=>a-b);
            // เปรียบเทียบกับ correctIndices (ทั้งสองต้องตรงเป๊ะ)
            const ok = nums.length === correctIndices.length && nums.every((v,i)=>v === correctIndices[i]);

            // =======================================================
            // ✨ ส่วนที่เพิ่มเข้ามา: การสร้าง Cookie ✨
            // =======================================================
            if (ok) {
                // ถ้าคำตอบถูกต้อง
                //alert('คำตอบถูกต้อง! กำลังนำคุณไปยังหน้าถอดรหัส...');
                document.cookie = "userAnswer=correct; path=/";
            } else {
                // ถ้าคำตอบไม่ถูกต้อง
               // alert('คำตอบไม่ถูกต้อง แต่ระบบจะยังคงสร้างรหัสให้คุณเพื่อไปต่อ...');
                document.cookie = "userAnswer=incorrect; path=/";
            }
            // =======================================================

            // นำทางไปยังหน้า result
            window.location.href = 'userAnswer.html';
        });

        // for debugging: console.log correct indices
        console.log('Correct suspicious user numbers:', correctIndices);
    </script>
</body>
</html>