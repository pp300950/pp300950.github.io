<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>X-ray Training Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #000;
        color: #fff;
        position: relative;
      }
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at center,
            rgba(255, 255, 255, 0.2) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 20% 80%,
            rgba(255, 200, 0, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 200, 0, 0.1) 0%,
            transparent 50%
          );
        filter: blur(5px);
        z-index: -1;
        opacity: 0.5;
      }
      #topbar {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 99;
        font-size: 18px;
        text-shadow: 0 0 3px #fff;
      }
      #container {
        text-align: center;
        padding-top: 50px;
      }
      .controls {
        display: flex;
        justify-content: center;
        gap: 5px;
      }
      .adjust {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 5px;
      }
      .adj-btn {
        padding: 5px 10px;
        font-size: 16px;
        background: #00ff00;
        color: #000;
        border: none;
        cursor: pointer;
        box-shadow: 0 0 5px #00ff00;
        border-radius: 5px;
      }
      input[type='range'] {
        width: 220px;
      }
      canvas {
        background: #000;
        border: 2px solid #0ff;
        margin-top: 10px;
        box-shadow: 0 0 10px #0ff;
      }
      #film {
        max-width: 350px;
        width: 50%;
        height: auto;
        transition: filter 0.5s;
        margin-top: 10px;
        box-shadow: 0 0 10px #0ff;
      }
      #status {
        margin-top: 10px;
        font-size: 20px;
      }
      #nextBtn {
        margin-top: 20px;
        padding: 10px 20px;
        font-size: 18px;
        background: #00ff00;
        color: #000;
        border: none;
        cursor: pointer;
        box-shadow: 0 0 5px #00ff00;
        border-radius: 10px;
      }
      #result {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    z-index: 10;
    text-align: center;
    overflow-y: auto;
    padding: 20px 20px 100px 20px;
    display: none;
    flex-direction: column;
    align-items: center;
    -webkit-overflow-scrolling: touch;
}
      #result h1 {
        color: #fff;
        text-shadow: 0 0 5px #0ff;
        margin-bottom: 10px;
      }
      #result #scoreText {
        font-size: 24px;
        margin-bottom: 20px;
        padding: 10px 20px;
        background: #222;
        border-radius: 10px;
        box-shadow: 0 0 10px #0ff;
      }
      #films {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 400px;
      }
      #films div {
        margin: 10px 0;
        text-align: center;
        background: #222;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 0 10px #0ff;
        width: 90%;
        max-width: 300px;
      }
      #films img {
        width: 100%;
        height: auto;
        margin-bottom: 10px;
        border-radius: 5px;
      }
      #intro {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 20;
        text-align: center;
        padding-top: 100px;
        display: block;
      }
      #intro h1,
      #container h1 {
        text-shadow: 0 0 5px #0ff;
      }
      #intro p,
      .controls p {
        text-shadow: 0 0 3px #fff;
      }
      #startBtn {
        padding: 15px 30px;
        font-size: 24px;
        background: linear-gradient(to bottom, #00ff00, #008000);
        color: #fff;
        border: none;
        cursor: pointer;
        box-shadow: 0 0 10px #00ff00;
        border-radius: 15px;
        margin-top: 20px;
        transition: transform 0.2s;
      }
      #startBtn:hover {
        transform: scale(1.05);
      }
      @media (max-width: 600px) {
        .controls {
          flex-direction: column;
        }
        .adjust {
          width: 80%;
          justify-content: space-between;
        }
        input[type='range'] {
          width: 60%;
        }
        #nextBtn {
          width: 80%;
        }
        #films {
          max-width: none;
        }
        #films div {
          width: 95%;
        }
        #container {
          padding: 20px;
        }
        canvas {
          width: 100% !important;
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <div id="topbar">
      ‚è± ‡πÄ‡∏ß‡∏•‡∏≤:
      <span id="time">45</span>
      s | üéØ ‡∏î‡πà‡∏≤‡∏ô:
      <span id="level">1</span>
      /10
    </div>
    <div id="container">
      <h1>X-ray Exposure Training</h1>
      <img id="film" />
      <canvas id="graph" height="250"></canvas>
      <div class="controls">
        <div>
          <p>‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô (kV)</p>
          <div class="adjust">
            <button class="adj-btn" onclick="decKv()">-</button>
            <input type="range" min="0" max="200" value="20" id="kv" />
            <button class="adj-btn" onclick="incKv()">+</button>
          </div>
          <div id="kvVal">20 kV</div>
        </div>
        <div>
          <p>‡∏Å‡∏£‡∏∞‡πÅ‡∏™ (mA)</p>
          <div class="adjust">
            <button class="adj-btn" onclick="decMa()">-</button>
            <input type="range" min="1" max="10" value="3" id="ma" />
            <button class="adj-btn" onclick="incMa()">+</button>
          </div>
          <div id="maVal">3 mA</div>
        </div>
      </div>
      <button id="nextBtn">‡∏†‡∏≤‡∏û‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
      <div id="status"></div>
    </div>
    <div id="result">
      <h1>‡∏à‡∏ö‡πÄ‡∏Å‡∏°!</h1>
      <p id="scoreText"></p>
      <div id="films"></div>
    </div>
    <div id="intro">
      <h1>X-ray Exposure Training</h1>
      <p>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô:</p>
      <p>
        ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô (kV) ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡πÅ‡∏™ (mA)
        ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
        ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô
      </p>
      <p>‡∏†‡∏≤‡∏û‡∏ü‡∏¥‡∏•‡πå‡∏°‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö ‡∏´‡∏≤‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏à‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô</p>
      <p>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏≠‡πÉ‡∏à ‡∏Å‡∏î "‡∏†‡∏≤‡∏û‡∏ñ‡∏±‡∏î‡πÑ‡∏õ" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ</p>
      <p>‡∏°‡∏µ 10 ‡∏î‡πà‡∏≤‡∏ô ‡∏ó‡∏≥‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 45 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
      <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
    </div>
    <script>
      const kv = document.getElementById('kv');
      const ma = document.getElementById('ma');
      const graph = document.getElementById('graph');
      const ctx = graph.getContext('2d');
      const film = document.getElementById('film');
      const nextBtn = document.getElementById('nextBtn');
      const resultDiv = document.getElementById('result');
      const intro = document.getElementById('intro');
      const startBtn = document.getElementById('startBtn');
      let canvasWidth = Math.min(600, window.innerWidth - 40);
      graph.width = canvasWidth;
      graph.height = 250;
      const levels = [
        { img: '1.jpg', optimal: 120, opt_ma: 5 },
        { img: '2.jpg', optimal: 160, opt_ma: 6 },
        { img: '3.jpg', optimal: 190, opt_ma: 4 },
        { img: '4.jpg', optimal: 130, opt_ma: 7 },
        { img: '5.jpg', optimal: 120, opt_ma: 3 },
        { img: '6.avif', optimal: 60, opt_ma: 8 },
        { img: '7.jpg', optimal: 180, opt_ma: 2 },
        { img: '8.jpg', optimal: 40, opt_ma: 9 },
        { img: '9.jpg', optimal: 90, opt_ma: 1 },
        { img: '10.jpeg', optimal: 170, opt_ma: 10 },
      ];
      let lvl = 0;
      let time = 45;
      let history = [];
      let results = [];
      let loop;
      film.src = levels[0].img;
      kv.oninput = () => {
        document.getElementById('kvVal').innerText = kv.value + ' kV';
        shoot();
      };
      ma.oninput = () => {
        document.getElementById('maVal').innerText = ma.value + ' mA';
        shoot();
      };
      function decKv() {
        kv.value = Math.max(kv.min, Number(kv.value) - 1);
        document.getElementById('kvVal').innerText = kv.value + ' kV';
        shoot();
      }
      function incKv() {
        kv.value = Math.min(kv.max, Number(kv.value) + 1);
        document.getElementById('kvVal').innerText = kv.value + ' kV';
        shoot();
      }
      function decMa() {
        ma.value = Math.max(ma.min, Number(ma.value) - 1);
        document.getElementById('maVal').innerText = ma.value + ' mA';
        shoot();
      }
      function incMa() {
        ma.value = Math.min(ma.max, Number(ma.value) + 1);
        document.getElementById('maVal').innerText = ma.value + ' mA';
        shoot();
      }
      startBtn.onclick = () => {
        intro.style.display = 'none';
        shoot();
        loop = setInterval(tick, 1000);
      };
      nextBtn.onclick = () => {
        if (lvl < levels.length) {
          results.push({
            img: levels[lvl].img,
            final_v: exposure(),
            final_ma: Number(ma.value),
            opt: levels[lvl].optimal,
            opt_ma: levels[lvl].opt_ma,
          });
          lvl++;
          if (lvl >= levels.length) {
            endGame();
            return;
          }
          history = [];
          film.src = levels[lvl].img;
          document.getElementById('level').innerText = lvl + 1;
          shoot();
        }
      };
      function exposure() {
        return kv.value * ma.value;
      }
      function drawGraph() {
        ctx.clearRect(0, 0, graph.width, graph.height);
        const maxV = 2000;
        function calcY(v) {
          return Math.max(0, 250 - (v / maxV) * 250);
        }
        // axis labels
        ctx.fillStyle = '#888';
        for (let i = 0; i <= maxV; i += 400) {
          let y = calcY(i);
          ctx.fillText(i, 5, y + 5);
          ctx.strokeStyle = '#222';
          ctx.beginPath();
          ctx.moveTo(40, y);
          ctx.lineTo(graph.width, y);
          ctx.stroke();
        }
        // optimal line
        ctx.lineWidth = levels[lvl].opt_ma * 2;
        ctx.strokeStyle = '#00ff00'; // green for optimal
        let oy = calcY(levels[lvl].optimal);
        ctx.beginPath();
        ctx.moveTo(40, oy);
        ctx.lineTo(graph.width, oy);
        ctx.stroke();
        ctx.lineWidth = 1;
        // graph
        ctx.strokeStyle = '#ff0000'; // red for user
        ctx.lineWidth = ma.value * 2;
        ctx.beginPath();
        history.forEach((v, i) => {
          let x = 40 + i * ((graph.width - 40) / 50);
          let y = calcY(v);
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.lineWidth = 1;
      }
      function getFilter(v, opt) {
        if (v < 0.4 * opt) return 'brightness(0.05)';
        else if (v < opt - 3) return 'brightness(0.4) contrast(1)';
        else if (Math.abs(v - opt) <= 3) return 'brightness(1) contrast(1.5)';
        else return 'brightness(3)';
      }
      function updateFilm(v) {
        const opt = levels[lvl].optimal;
        film.style.filter = getFilter(v, opt);
      }
      function shoot() {
        let v = exposure();
        history.push(v);
        if (history.length > 50) history.shift();
        drawGraph();
        updateFilm(v);
      }
      function endGame() {
        clearInterval(loop);
        let total_score = 0;
        const filmsDiv = document.getElementById('films');
        results.forEach((r, i) => {
          let diff_v = Math.abs(r.final_v - r.opt);
          let exp_points = Math.max(0, 7 - Math.max(0, diff_v - 3));
          let diff_ma = Math.abs(r.final_ma - r.opt_ma);
          let ma_points = Math.max(0, 3 - diff_ma);
          let level_score = exp_points + ma_points;
          total_score += level_score;
          let container = document.createElement('div');
          let img = document.createElement('img');
          img.src = r.img;
          img.style.filter = getFilter(r.final_v, r.opt);
          if (level_score > 6) {
            img.style.border = '2px solid green';
          } else {
            img.style.border = '2px solid red';
          }
          container.appendChild(img);
          let p = document.createElement('p');
          p.innerText = `‡∏î‡πà‡∏≤‡∏ô ${
            i + 1
          }: ${level_score}/10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (exposure: ${exp_points}/7, ma: ${ma_points}/3)`;
          container.appendChild(p);
          filmsDiv.appendChild(container);
        });
        let average = total_score / 10;
        let display_score = Math.ceil(average);
        document.getElementById(
          'scoreText'
        ).innerText = `‡πÑ‡∏î‡πâ ${display_score}/10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
        resultDiv.style.display = 'flex';
      }
      function tick() {
        time--;
        document.getElementById('time').innerText = time;
        if (time <= 0) {
          if (lvl < levels.length) {
            results.push({
              img: levels[lvl].img,
              final_v: exposure(),
              final_ma: Number(ma.value),
              opt: levels[lvl].optimal,
              opt_ma: levels[lvl].opt_ma,
            });
          }
          endGame();
        }
      }
      window.addEventListener('resize', () => {
        canvasWidth = Math.min(600, window.innerWidth - 40);
        graph.width = canvasWidth;
        drawGraph();
      });
    </script>
  </body>
</html>
