<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Flowchart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
                Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f2f5;
        }
        #tooltip {
            position: absolute;
            text-align: left;
            padding: 12px;
            font-size: 14px;
            background: #ffffff;
            border: 1px solid #d1d1d1;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            word-wrap: break-word;
        }
        .node text {
            pointer-events: none;
            font-size: 10px;
            fill: #333;
        }
        .link-label {
             font-size: 8px;
             fill: #555;
             pointer-events: none;
        }
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 10;
        }
        label {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="charge-slider">Node Repulsion: </label>
        <input type="range" min="-1000" max="0" value="-150" id="charge-slider">
    </div>
    <div id="tooltip"></div>
    <script>
        const storyData = [
            {
                id: 'start',
                text: 'ยินดีต้อนรับสู่โลกแห่งการเจรจา, {name} ที่นี่คุณจะได้เรียนรู้ถึงความสำคัญของคำพูด และการตัดสินใจในภารกิจที่อาจเปลี่ยนชะตาของประเทศชาติ',
                background: 'Pic/checkhand.jpeg',
                choices: [],
            },
            {
                id: 'intro1',
                text: 'คุณจะได้รับบทเป็นนักเจรจา ทุกคำพูดของคุณมีพลังที่จะเปลี่ยนแปลงทุกสิ่ง คำพูดของคุณจะเป็นตัวกำหนดอนาคต!',
                background: 'Pic/present2.jpeg',
                choices: [],
            },
            {
                id: 'intro2',
                text: 'ที่นี่คือสถานทูต เป็นที่ทำงานของคุณ คุณเข้าทำงานในวันเเรกก็มีภารกิจเข้ามาเเล้ว!',
                background: 'Pic/placWork.jpeg',
                choices: [],
            },
            {
                id: 'intro3',
                title: 'ข่าวลือเรื่องการลักลอบขนส่งอาวุธข้ามพรมแดนประเทศเราไปที่ประเทศเซเนียร์',
                text: 'หน่วยข่าวกรองรายงานว่ามีการลักลอบขนอาวุธจากประเทศของคุณไปที่เขตเเดนของเซเนียร์ คุณในฐานะนักการทูตต้องตัดสินใจว่าจะรับมืออย่างไร',
                background: 'Pic/box.jpeg',
                choices: [],
            },
            {
                id: 'mission1',
                text: 'คุณควรเคลื่อนไหวอย่างไร ในการกระทำครั้งนี้?',
                background: 'Pic/present.jpeg',
                choices: [
                    {
                        text: 'ประกาศผ่านสื่อระหว่างประเทศว่าฝ่ายตรงข้ามกำลังละเมิดอธิปไตยของคุณ',
                        next: 'event2',
                    },
                    {
                        text: 'ขอเข้าพบตัวแทนของประเทศเซเนียร์เพื่อพูดคุยอย่างสันติ',
                        next: 'event1',
                    },
                    {
                        text: 'ส่งกองกำลังลาดตระเวนพร้อมแถลงการณ์เตือนอย่างแข็งกร้าว',
                        next: 'event3',
                    },
                ],
            },
            {
                id: 'event1',
                text: 'คุณเลือกที่จะหลีกเลี่ยงความขัดแย้งและพยายามเจรจากับฝ่ายตรงข้าม เเละคุณก็ได้รับคำเชิญไปเจรจากับนักการทูตฝ่ายตรงข้ามที่ดูเป็นมิตรมาก!',
                background: 'Pic/checkhand3.jpeg',
                choices: [
                    { text: 'ไปตามคำเชิญ', next: 'event1-1' },
                    { text: 'ไม่ไปตามคำเชิญ', next: 'event1-2' },
                ],
            },
            {
                id: 'event2',
                text: 'คุณเลือกที่จะทำให้เกิดการโต้แย้งรุนแรงและเพิ่มความตึงเครียดระหว่างประเทศ โดยนักการทูตจากประเทศเซเนียร์ได้ติดต่อมาเพื่อขอเจรจาทันที โดยการส่งนักการทูตที่มีความเชี่ยวชาญในการเจรจาระหว่างประเทศมา!',
                background: 'Pic/argue.jpeg',
                choices: [
                    { text: 'อนุญาตให้เค้าเข้าพบ', next: 'event2-1' },
                    { text: 'ไม่อนุญาตให้เค้าเข้าพบ', next: 'event2-2' },
                ],
            },
            {
                id: 'event2-1',
                text: 'นักการทูตท่าทางเย็นชาเเละเข้งขึมได้เข้ามาภายในห้องของคุณเเละเริ่มพูดคุยกับคุณทันที',
                background: 'Pic/openthedoor.jpeg',
                choices: [{ text: 'ต่อไป', next: 'event2-1-1' }],
            },
            {
                id: 'event2-2',
                text: 'คุณปฏิเสธไม่พบกับนักการทูตของเซเนียร์ เเละเล่นเกมบอลต่อ(ภายในห้องรัฐสภา)',
                background: 'Pic/playgame.jpeg',
                choices: [{ text: 'ต่อไป', next: 'event2-2-1' }],
            },
            {
                id: 'event2-2-1',
                title: 'ทันใดนั้น!?',
                text: 'นักการทูตของเซเนียร์ ก็ถีบประตูห้องเข้ามาด้วยท่าทางเข้งขึม ก่อนเดินตรงมาดึงหูของคุณไปคุยที่ห้องรับเเขก',
                background: 'Pic/openthedor2.jpeg',
                choices: [{ text: 'ต่อไป', next: 'event2-1-1' }],
            },
            {
                id: 'event2-1-1',
                title: 'นักการทูตคนนั้นได้กล่าวว่า',
                text: 'ผมชื่อเจฟ เป็นตัวเเทนจากประเทศเซเนียร์ เรารู้ดีว่าท่านรู้สึกไม่ดีเกี่ยวกับการเคลื่อนไหวทางทหารของประเทศเราในบริเวณชายเเดน',
                background: 'Pic/talk.jpeg',
                choices: [{ text: 'ต่อไป', next: 'event2-1-1-1' }],
            },
            {
                id: 'event2-1-1-1',
                title: 'เจฟได้กล่าวต่อว่า',
                text: 'ผมมาที่นี่เพื่อขอให้คุณลบสิ่งที่ประเทศของคุณได้ประกาศออกไปผ่านสื่อออกให้หมด เนื่องจากสิ่งที่ประกาศนั้นไม่ใช่ความจริงเลย พวกคุณกำลังเข้าใจผิด',
                background: 'Pic/talk.jpeg',
                choices: [
                    {
                        text: 'ถ้าเช่นนั้นคุณช่วยบอกได้หรือไม่ถึงเหตุผลที่เซเนียร์ลักลอบขนอาวุธ จากประเทศของเราไปที่เซเนียร์',
                        next: 'event2-1-1-1-3',
                    },
                    {
                        text: 'หยิบหน้ากากลงอาคมขึ้นมาใส่เเละสวดเพื่อขอให้ผีช่วยให้การเจรจาครั้งนี้สำเร็จ',
                        next: 'event2-1-1-1-2',
                    },
                    {
                        text: 'ผมขอ 20 บาทเอาไว้ซื้อบุหรี่ได้ไหมลืมเอาเงินมา ส่วนเรื่องลบข่าวผมคิดไว้อยู่เเล้วว่าจะลองไปคุยดู เพราะไม่อยากให้เรื่องวุ่นวายมากไปกว่านี้',
                        next: 'event2-1-1-1-1',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-3',
                title: 'เจฟได้กล่าวว่า',
                text: '',
                background: 'Pic/talk.jpeg',
                choices: [
                    {
                        text: '',
                        next: '',
                    },

                ],
            },
            {
                id: 'event2-1-1-1-2',
                title: 'เจฟนั่งดูคุณพูดคนเดียวสักพัก',
                text: 'โอเคร... ดูเหมือนคุณจะเชื่อเรื่องเหนือธรรมชาติ เเต่จำเป็นต้องทำต่อหน้าผมเลยหรอ?',
                background: 'Pic/mask.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event2-1-1-1-2-1',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-2-1',
                title: 'เจฟที่คิดว่าคุณเเปลกก็เลยเดินออกจากห้องไป',
                text: 'เเละเดินกลับมาพร้อมหน้ากากตุ๊กตาหมีรุ่นลิมมิเต็ด สะท้อนทุกความเสียหายจากทุกศาสนาในโลก',
                background: 'Pic/teddi.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: '',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-1',
                title: 'เจฟตอบขึ้นมาทันทีว่า',
                text: 'ผมให้ 6,000 เอาไปซื้อบุหรี่สูบสักลังนึ่งนะ ขอบคุณที่ช่วยผม',
                background: 'Pic/20thb.jpeg',
                choices: [
                    {
                        text: 'รับเงิน',
                        next: 'event2-1-1-1-1.1',
                    },
                    {
                        text: 'ไม่รับเงิน',
                        next: 'event2-1-1-1-1.2',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-1.2',
                text: 'เจฟถามคุณว่าทำไมไม่รับเงินไป?',
                background: 'Pic/talk.jpeg',
                choices: [
                    {
                        text: 'ผมเป็นคนดี ไม่รับสินบน',
                        next: 'event2-1-1-1-1.2/1',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-1.2/1',
                title: 'เจฟใช้มือตบเข้าที่ขมับขวาของคุณเเล้วพูดว่า',
                text: '"อย่ากวนตีน เมื่อกี้คุณพึ่งขอเงินผม" เเล้วตะคอกให้คุณรับเงินของเขาไป',
                background: 'Pic/hand.jpeg',
                choices: [
                    {
                        text: 'รับเงิน (เพราะกลัวโดนเข้าขยับซ้ายด้วย ถ้าไม่รับ)',
                        next: 'event2-1-1-1-1.1',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-1.1',
                text: 'หลังจากนั้นคุณก็ได้พูดคุยกับเจฟเรื่องที่เซเนียร์มีการลักลอบขนอาวุธบริเวณชายเเดน ซึ่งเจฟก็ได้หาข้อเเก้ต่างมากมายมาใช้พูดกับคุณ เเต่คุณก็มีไหวพริบดีเเละดูออกทั้งหมด',
                background: 'Pic/talk.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event2-1-1-1-1.1-1/1',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-1.1-1/1',
                text: 'คุณได้พูดต่อรองเเละทำข้อตกลงกับเจฟอยู่นานเเม้คุณจะยังไม่ทราบเเน่ชัด ว่าเกิดอะไรขึ้นที่บริเวณชายเเดนกันเเน่ การกระทำของคุณทำให้เจฟนิ่งไปสักพักก่อนจะเดินตรงไปที่ประตูทางออกทันที',
                background: 'Pic/talk.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event2-1-1-1-1.1-1/1.1',
                    },
                ],
            },
            {
                id: 'event2-1-1-1-1.1-1/1.1',
                title: 'เจฟได้พูดก่อนออกจากห้องว่า',
                text: 'คุณ{name} คุณเป็นคนที่ฉลาดนะ เเต่ในการเจรจาครั้งนี้คุณน่ะ-เเพ้เเล้วล่ะ... ก่อนจะเดินออกจากห้องไป',
                background: 'Pic/exit.jpeg',
                choices: [
                    {
                        text: 'คุณรู้สึกสงสัยเกี่ยวกับสิ่งที่เค้าพูด',
                        next: 'ending2',
                    },
                ],
            },
            {
                id: 'ending2',
                text: 'ในวันต่อมาคุณถูกจับเนื่องจากมีข่าวว่าคุณรับสินบน เเม้คุณจะปฏิเสธว่าเจฟเเค่ให้เงินคุณไปซื้อบุหรี่เล็กน้อยเท่านั้นเเต่เงิน 540,000 บาทนั้นสูงเกินไปสำหรับบุหรี่เเละเข้าข่ายรับสินบน',
                background: 'Pic/polic.jpeg',
                choices: [
                    {
                        text: 'คุณเเก้ต่างว่ามันเเค่ 6,000 บาทเอง เด้งไป5เเสนได้ไง',
                        next: 'chap1',
                    },
                ],
            },
            {
                id: 'chap1',
                text: 'ตำรวจอธิบายว่า ค่าเงินบาทกับของเซเนียร์ต่างกัน ค่าเงินของเซเนียร์อัตราเเลกเปลี่ยนเป็นเงินบาทคือ1ต่อ90 ดังนั้น 6,000เซเนียร์ = 540,000 บาท',
                background: 'Pic/polic.jpeg',
                choices: [
                    {
                        text: 'คุณพึ่งจะรู้ว่า ที่เจฟกล่าว"คุณเเพ้เเล้ว"หมายถึงอะไร',
                        next: 'ending1',
                    },
                ],
            },
            {
                id: 'event3',
                text: 'คุณเลือกที่จะเพิ่มความตึงเครียดระหว่างชายเเดน ซึ่งคุณได้รับการติดต่อจากนักการทูตที่เก่งกาจและได้รับเชิญไปเจรจาท่ามกลางความตึงเครียด',
                background: 'Pic/argue.jpeg',
                choices: [
                    { text: 'อนุญาตให้เค้าเข้าพบ', next: '' },
                    { text: 'ไม่อนุญาตให้เค้าเข้าพบ', next: '' },
                ],
            },
            {
                id: 'event1-1',
                title: 'ท่านได้รับการกล่าวต้อนรับจากนักการทูตผู้นั้น',
                text: '"ยินดีต้อนรับค่ะ ดิชั้นชื่ออันนาเป็นตัวเเทนของประเทศเซเนียร์ค่ะ ท่านคงจะเป็นคุณ {name} สินะคะ การมาที่นี่ของท่านเป็นสัญญาณที่ดีที่จะช่วยให้สถานการณ์นี้ไม่บานปลายไปมากกว่านี้ค่ะ"',
                background: 'Pic/cute_person.jpeg',
                choices: [
                    {
                        text: 'กล่าวถามถึงเหตุผล ของการลักลอบขนส่งอาวุธข้ามพรมแดนกับอีกอันนา',
                        next: 'event1-1-1',
                    },
                    {
                        text: 'ชมว่าเธอสวยมากเลยก่อนจะขอเบอร์ของเธอ เเละชวนเธอออกเดท ชั่งเรื่องงาน',
                        next: 'event1-1-2',
                    },
                    {
                        text: 'ขู่อันนาว่าหากพวกเรายังพบเห็นประเทศพวกคุณทำลับๆล่อๆ บริเวณเขตเเดนระหว่างประเทศของเรา เราจะเลิกขายไฟฟ้าให้เเก่ประเทศคุณ!',
                        next: 'event1-1-3',
                    },
                ],
            },
            {
                id: 'event1-1-2',
                title: 'อันนารู้สึกถูกคุมคามจากการกระทำของคุณเธอจึงเรียก หน่วยรักษาความปลอดภัยหน้าห้องมา',
                text: 'ก่อนจะมีผู้ชายคนนึ่งท่าทางเข้มขึงเดินตรงเข้ามาในห้องเเละกระชากคอเสื้อคุณขึ้น คุณโดนเข้าไปหมัดนึ่งจังๆที่ตาขวาก่อนหมดสติไป',
                background: 'Pic/boyfriend.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: '',
                    },
                ],
            },

            {
                id: 'event1-1-3',
                title: 'อันนาจึงตอบกลับว่า',
                text: 'ค่ะ ดิชั้นเข้าใจดีสำหรับข้อกังวลของคุณค่ะ ประเทศของเรายึดมั่นในหลักแห่งความโปร่งใสและการเคารพในอธิปไตยของประเทศเพื่อนบ้านเสมอค่ะ หากมีพฤติกรรมใดที่อาจก่อให้เกิดความเข้าใจผิด ทางเราพร้อมเปิดการหารืออย่างจริงใจเพื่อชี้แจงและร่วมมือกันในทางสร้างสรรค์ เพราะเราเชื่อว่าความมั่นคงและความมั่งคั่งของภูมิภาคขึ้นอยู่กับความสัมพันธ์ที่แน่นแฟ้นและความไว้เนื้อเชื่อใจกันระหว่างประเทศค่ะ',
                background: 'Pic/cute_person.jpeg',
                choices: [
                    {
                        text: 'ชวนอันนาไปคุยต่อที่ร้านอาหาร (เนียนออกเดท)',
                        next: 'event1-1-3-1',
                    },
                ],
            },
            {
                id: 'event1-1-3-1',
                title: 'ณ ที่ร้านอาหาร',
                text: 'คุณใช้โอกาสนี้ในการถามอันนา เกี่ยวกับข้อมูลทางการเมืองของเซเนียร์จากอันนา เเละได้ทราบว่าที่เซเนียร์เองในตอนนี้มีประเทศอย่าง ประเทศชินิส คอยหนุนหลังอยู่ รอเสียบทันทีที่ประเทศของคุณเลิกขายไฟฟ้าให้เเก่เซเนียร์',
                background: 'Pic/bar.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event1-1-3-1.1',
                    },
                ],
            },
            {
                id: 'event1-1-3-1.1',
                text: 'ซึ่งคุณทราบดีว่าประเทศชินิส เป็นประเทศคู่เเข่งของประเทศคุณ ซึ่งหากประเทศชินีส ได้เซเนียร์ไปครองอาจจะทำให้ชินีสสามารถขยายอาณาเขตออกมาได้ไกลมากขึ้น รวมถึงกำลังทางทหารที่มากขึ้นด้วย',
                background: 'Pic/bar.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event1-1-3-1.1-1#1',
                    },
                ],
            },
            {
                id: 'event1-1-3-1.1-1#1',
                text: 'เมื่อคุณเริ่มรู้สึกว่าเรื่องเหล่านี้มันมีบางอย่างเเปลกๆ คุณก็เลยเนียนขอเบอร์อันนาเอาไว้ ก่อนพวกคุณจะเเยกย้ายกัน',
                background: 'Pic/bar.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event1-1-3-1.1-1',
                    },
                ],
            },

            {
                id: 'event1-1-3-1.1-1',
                title: 'หลายวันต่อมา',
                text: 'คุณได้นำเรื่องที่อันนาบอกมาคิด เนื่องจากเรื่องของการขนส่งอาวุธข้ามประเทศนั้น ตัวอันนาก็ยังไม่ทราบดี เพราะเธอเองก็เพียงถูกส่งมาเพื่อดูเชิงของประเทศเราเพียงเท่านั้น',
                background: 'Pic/think.jpeg',
                choices: [
                    {
                        text: 'โทรหาอันนา',
                        next: 'event1-1-3-1.1-1-1',
                    },
                ],
            },
            {
                id: 'event1-1-3-1.1-1-1',
                text: 'คุณติดต่อหาอันนาเเละบอกกับเธอว่าคุณสงสัยว่าภายในประเทศเซเนียร์ เเละประเทศของผมนั้นอาจจะมีใส้ศึกอยู่ภายในประเทศ เนื่องจากมีการเคลื่อนไหวผิดปกติ ที่เเม้เเต่คนในประเทศยังไม่ทราบ',
                background: 'Pic/phone.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event1-1-3-1.1-1-1.1',
                    },
                ],
            },
            {
                id: 'event1-1-3-1.1-1-1.1',
                text: 'อันนาตอบว่าเธอเองก็คิดเช่นนั้น พวกคุณทั้งสองจึงนัดกันไปตรวจสอบที่บริเวณชายเเดนที่มีการรายงาน ว่าพบการขนอาวุธข้ามประเทศ',
                background: 'Pic/plan.jpeg',
                choices: [
                    {
                        text: '',
                        next: '',
                    },
                ],
            },
            {
                id: 'event1-2',
                text: 'เมื่อคุณเลือกที่จะปฎิเสธคำเชิญ ทางประเทศของคุณจึงได้ส่งนักการทูตระดับรองไปเเทน ซึ่งผลลัพธ์ของการเจรจาไม่เป็นที่น่าพอใจนัก',
                background: 'Pic/person.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event1-2-1',
                    },
                ],
            },
            {
                id: 'event1-2-1',
                text: 'นักการทูตที่ประเทศของคุณส่งไปได้ยินยอมที่จะขายเขตเเดนของประเทศที่อยู่ติดกับเขตเเดนของเซเนียร์ ให้กับเซเนียร์ไป การกระทำในครั้งนี้ทำให้ประเทศของคุณเสียดินเเดนไปบางส่วน เเม้ประเทศคุณจะเป็นฝ่ายที่คอยขายไฟฟ้าให้เเก่เซเนียร์ก็ตาม เเละคุณไม่ทราบถึงเหตุผลของการขายชาติดังกล่าวเลย',
                background: 'Pic/person.jpeg',
                choices: [
                    {
                        text: 'ต่อไป',
                        next: 'event1-2-1.1',
                    },
                ],
            },
            {
                id: 'event1-2-1.1',
                text: 'คุณถูกปลดจากตำเเหน่งนักการทูตของประเทศ ก่อนที่นักการทูตคนที่ขายดินเเดนของประเทศให้กับเซเนียร์ จะได้รับตำเเหน่งนักการทูตของประเทศเเทน เค้าคนนั้นมีชื่อว่า เจอร์มี่ เเม้คุณจะสงสัยว่ามันเกิดอะไรขึ้นกันเเน่เเต่ก็ทำอะไรได้ไม่มาก',
                background: 'Pic/dismiss.jpeg',
                choices: [
                    {
                        text: 'ตัดสินใจสิ้นสุดการทำงานในสายอาชีพนี้ เเล้วไปขายหมูปิ้ง',
                        next: 'event1-2-1.1-1',
                    },
                    {
                        text: 'เริ่มการสืบสวนเจอร์มี่อย่างลับๆ',
                        next: 'event1-2-1.1-2',
                    },
                ],
            },
            {
                id: 'event1-2-1.1-2',
                title: 'จากการสืบสวนคุณพบว่า',
                text: 'เจอร์มี่นั้นเกิดที่ประเทศ ชินีส เเต่หลังจากพ่อเเม่เขาเสียจากสงครามกลางเมืองในชินีส เจอร์มี่จึงย้ายมาทำงานที่ประเทศของคุณเเทน',
                background: 'Pic/findDetailJermi.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-2-1.1-2-1',
                    },

                ],
            },
            {
                id: 'event1-2-1.1-2-1',
                title: 'เเละคุณยังสืบสวนพบอีกว่า',
                text: 'ในเหตุการที่เจอร์มี่เจรจาขายบางส่วนของประเทศให้เซเนียร์ เค้ากลับได้ดิบได้ดีเเทนที่จะถูกประนาม เนื่องจากรัฐบาลของประเทศคุณพอใจกับเงินที่ได้จากการขายประเทศมาก ทุกคนจึงยินดีที่จะให้เจอร์มี่เป็นทูตหลักของประเทศ',
                background: 'Pic/findDetailJermi.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-2-1.1-2-1-1',
                    },

                ],
            },
            {
                id: 'event1-2-1.1-2-1-1',
                text: 'เเม้คุณจะรู้ดีว่ามีพวกโจรขายชาตินั่งอยู่ในตำเเหน่งผู้บริหารเเผ่นดิน เเต่คุณในตอนนี้ก็ไม่สามารถทำอะไรเค้าได้อีกเเล้ว',
                background: 'Pic/findDetailJermi.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-2-1.1-2-1-1*1',
                    },

                ],
            },
            {
                id: 'event1-2-1.1-2-1-1*1',
                text: 'เเละหลังจากนั้น5ปี เจอร์มี่ถูกส่งไปเจรจากับผู้นำของประเทศชินีส ด้วยที่มีความเเค้นกับประเทศชินีสในเหตุที่พ่อเเม่เค้าเสีย เจอร์มี่จึงเจรจาเริ่มทำสงครามกำกับชินีสทันที หลังกลับประเทศเจอร์มี่ถูกด่าอย่างรุนเเรงจากรัฐบาล',
                background: 'Pic/war.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-2-1.1-2-1-1*1-1',
                    },

                ],
            },
            {
                id: 'event1-2-1.1-2-1-1*1-1',
                title: '2ปีหลังจากประเทศคุณประกาศสงครามกับชินีส',
                text: 'สุดท้ายประเทศของคุณก็ได้ประกาศเเพ้สงคราม เนื่องจากสู้สงครามสองทิศทั้งจากชินีสเเละเซเนียร์ที่เป็นประเทศลูกของชินีสไม่ไหว',
                background: 'Pic/built.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'ending1',
                    },
                ],
            },
            {
                id: 'event1-2-1.1-1',
                text: 'คุณใช้ชีวิตเป็นพ่อค้าขายหมูปิ้งอย่างสงบสุข',
                background: 'Pic/grillPork.jpeg',
                choices: [
                    {
                        text: 'รายละเอียดของเกมส์นี้',
                        next: 'ending1',
                    },
                ],
            },
            {
                id: 'event1-1-1',
                title: 'อันนาตอบว่า',
                text: 'การขนย้ายอาวุธไม่ได้มีเจตนาร้ายนะคะ เราจำเป็นต้องซื้ออาวุธจากประเทศของคุณเพื่อเสริมสร้างความมั่นคงภายในประเทศ อาวุธเหล่านี้เราติดต่อซื้อจากบริษัทเอกชนภายในประเทศของคุณค่ะ',
                background: 'Pic/cute_person.jpeg',
                choices: [
                    {
                        text: 'เเต่ภายในประเทศของผมไม่มีบริษัทผลิตอาวุธปืนนะครับ!?',
                        next: 'event1-1-1.1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1',
                text: 'คุณกล่าวถามอันนาด้วยความสงสัย เนื่องจากประเทศของคุณไม่มีการผลิตอาวุธภายในประเทศ รวมถึงฝั่งเซเนียร์เองเเม้จะอ้างว่ามีการซื้ออย่างถูกต้องเเต่ทำไม หน่วยข่าวกรองรายงานว่าเป็นการลักลอบขนอาวุธข้ามพรมเเดน',
                background: 'Pic/ask.jpeg',
                choices: [
                    {
                        text: 'คุณมองอันนาด้วยสายตาที่รู้สึกสงสัย',
                        next: 'event1-1-1.1*1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1',
                text: 'เช่นนั้นหากอันนาพูดจริง อาวุธที่เค้าบอกว่ามีการซื้อขายกัน อาวุธเหล่านั้นได้มาจากไหน ในขณะนี้คุณมีความสงสัยภายในหัวเต็มไปหมด',
                background: 'Pic/think2.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-1-1.1*1-1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1',
                text: 'อันนาเห็นคุณกำลังทำท่าทางคิดบางอย่างอยู่ จึงเดินไปชงกาเเฟมาให้คุณดื่ม',
                background: 'Pic/coffe.jpeg',
                choices: [
                    {
                        text: 'ดื่มสักหน่อยอาจจะทำให้คิดอะไรออกบ้าง',
                        next: 'event1-1-1.1*1-1/2',
                    },
                    {
                        text: 'ไม่ดื่ม เผื่ออันนาวางยาพิษทำไง',
                        next: 'event1-1-1.1*1-1/1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/2',
                title: 'คุณสำลักน้ำกาเเฟที่ดื่มไป!!',
                text: 'คุณมีสองทางเลือก จะพยายามกลืนมันลงไปหรือสำลอกออกมา',
                background: 'Pic/cafestuck.jpeg',
                choices: [
                    {
                        text: 'กลืนกาเเฟลงไป',
                        next: 'event1-1-1.1*1-1/2-2',
                    },
                    {
                        text: 'พยายามสำลอกกาเเฟออกมา',
                        next: 'event1-1-1.1*1-1/2-1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/2-2',
                title: 'กาเเฟที่อันนาชงให้คุณอร่อยมาก',
                text: 'หลังจากนั้นพวกคุณได้คุยกันต่ออีกสักพัก ก่อนที่อันนาจะชวนคุณไปคุยต่อที่ร้านอาหารเเทน',
                background: 'Pic/cafe3.jpeg',
                choices: [
                    {
                        text: 'ตอบตกลงในทันที',
                        next: 'event1-1-3-1',
                    },
                    {
                        text: 'ตอบอันนาไปว่าไม่ค่อยว่าง (เล่นตัวนิดนึงๆ)',
                        next: 'event1-1-1.1*1-1/2-2-1',
                    },

                ],
            },
            {
                id: 'event1-1-1.1*1-1/2-2-1',
                text: 'ด้วยการที่คุณปฏิเสธที่จะคุยกับอันนาที่ร้านอาหาร เธอจึงนั่งคุยกับคุณต่ออีก6ชั่งโมง เกี่ยวกับการหาทางออกที่ทำให้ทั้งสองประเทศสบายใจกันไปก่อน เเม้จะยังไม่ทราบเเน่ชัดว่าเกิดอะไรขึ้นกันเเน่ที่บริเวณชายเเดน',
                background: 'Pic/cute_person.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-1-1.1*1-1/2-2-1*1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/2-2-1*1',
                title: 'ระหว่างคุยกันคุณรู้สึกเบื่อมาก',
                text: 'คุณจึงขอให้อันนาช่วยสักลายให้ที่เเขนซ้ายระหว่างสนทนากันไปด้วย โดยให้สักเป็นรูปหน้าอันนาเลย',
                background: 'Pic/drawe.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-1-1.1*1-1/2-2-1*1*1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/2-2-1*1*1',
                text: 'เเต่ด้วยที่คุณนั่งนานเกินไปทำให้ขาของคุณเป็นเหน็บชา คุณที่ทนความเจ็บปวดนี้ไม่ได้จึงเสียชีวิตต่อหน้าอันนาที่ยังสักลายบนเเขนคุณยังไม่เสร็จเลยด้วยซ้ำ',
                background: 'Pic/leg.jpeg',
                choices: [
                    {
                        text: 'เป็นเหน็บชาตายเนี่ยนะ บ้าบอ ชมัด!',
                        next: 'ending3',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/2-1',
                text: 'สุดท้ายกาเเฟที่อันนาชงให้คุณ คุณก็ไม่ได้ดื่มมันเลย เพระาสำลอกออกหมด',
                background: 'Pic/sleep.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-1-1.1*1-1/1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/1',
                text: 'จู่ๆคุณก็รู้สึกหน้ามืดก่อนหมดสติลง',
                background: 'Pic/sleep.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-1-1.1*1-1/1*1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/1*1',
                text: 'คุณเผลอหลับไปในขณะที่กำลังคุยกับอันนา เนื่องจากไม่ได้ดื่มกาเเฟ',
                background: 'Pic/sleep.jpeg',
                choices: [
                    {
                        text: 'ถัดไป',
                        next: 'event1-1-1.1*1-1/1*1-1',
                    },
                ],
            },
            {
                id: 'event1-1-1.1*1-1/1*1-1',
                text: 'หลังจากนั้นคุณก็ไม่ตื่นอีกเลย ตำรวจที่มาสืบสวนพบว่าสาเหตุการเสียชีวิตของคุณเกิดจากอาการไหลตาย เนื่องจากร่างกายขาด คาเฟอีน',
                background: 'Pic/deat.jpeg',
                choices: [
                    {
                        text: 'บ้าน่า ชั้นตายหรอเนี่ย! ไหลตายด้วย บ้าเอ้ย',
                        next: 'ending3',
                    },
                ],
            },
            {
                id: 'ending3',
                text: 'เรื่องราวของคุณจบลงที่นี่ ขอให้ท่านไปสู่สุขคติ',
                background: 'Pic/ghoat.jpeg',
                choices: [
                    {
                        text: 'ดูข้อมูลผู้สร้าง',
                        next: 'go-to-credits',
                    },
                ],
            },
            {
                id: 'ending1',
                text: 'เรื่องราวของคุณจบลงที่นี่ ขอบคุณที่ร่วมผจญภัยกับเรา!',
                background: 'Pic/test.jpeg',
                choices: [
                    {
                        text: 'ดูข้อมูลผู้สร้าง',
                        next: 'go-to-credits',
                    },
                ],
            },
             // Duplicate ending1 removed for clarity in graph
            {
                id: 'go-to-credits',
                text: '',
                background: '',
                choices: [],
            },
        ];

        // Process data for D3
        const nodes = [];
        const links = [];
        const nodeIds = new Set();
        const nodeMap = new Map();

        // Remove duplicates and create a map
        storyData.forEach(node => {
            if (node.id && !nodeMap.has(node.id)) {
                nodeMap.set(node.id, node);
            }
        });

        nodeMap.forEach(node => {
            nodes.push({
                id: node.id,
                title: node.title || node.id,
                text: node.text,
                isEnding: node.id.startsWith('ending') || node.id.startsWith('chap1'),
                isChoice: node.choices.length > 1,
                isStart: node.id === 'start'
            });
            nodeIds.add(node.id);
        });
        
        // Create links based on choices and implicit sequence
        const introSequence = ['start', 'intro1', 'intro2', 'intro3', 'mission1'];
        for (let i = 0; i < introSequence.length - 1; i++) {
             if (nodeIds.has(introSequence[i]) && nodeIds.has(introSequence[i+1])) {
                links.push({
                    source: introSequence[i],
                    target: introSequence[i+1],
                    label: 'Continue'
                });
            }
        }

        nodeMap.forEach(sourceNode => {
            if (sourceNode.choices && sourceNode.choices.length > 0) {
                sourceNode.choices.forEach(choice => {
                    if (choice.next && nodeIds.has(choice.next)) {
                        links.push({
                            source: sourceNode.id,
                            target: choice.next,
                            label: choice.text.substring(0, 25) + (choice.text.length > 25 ? '...' : '')
                        });
                    }
                });
            }
        });


        const width = window.innerWidth;
        const height = window.innerHeight;

        const svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        const container = svg.append("g");

        // Add zoom and pan
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                container.attr("transform", event.transform);
            });
        svg.call(zoom);

        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-200))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("x", d3.forceX(width / 2).strength(0.05))
            .force("y", d3.forceY(height / 2).strength(0.05));
        
        // Update charge strength from slider
        d3.select("#charge-slider").on("input", function() {
            simulation.force("charge").strength(+this.value);
            simulation.alpha(0.3).restart();
        });

        // Arrowhead marker
        container.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "-0 -5 10 10")
            .attr("refX", 23)
            .attr("refY", 0)
            .attr("orient", "auto")
            .attr("markerWidth", 8)
            .attr("markerHeight", 8)
            .attr("xoverflow", "visible")
            .append("svg:path")
            .attr("d", "M 0,-5 L 10 ,0 L 0,5")
            .attr("fill", "#999")
            .style("stroke", "none");

        const link = container.append("g")
            .attr("stroke", "#999")
            .attr("stroke-opacity", 0.6)
            .selectAll("line")
            .data(links)
            .join("line")
            .attr("stroke-width", d => Math.sqrt(d.value))
            .attr("marker-end", "url(#arrowhead)");

        const node = container.append("g")
            .selectAll("g")
            .data(nodes)
            .join("g")
            .attr("class", "node")
            .call(drag(simulation));

        node.append("circle")
            .attr("r", 15)
            .attr("stroke", "#fff")
            .attr("stroke-width", 1.5)
            .attr("fill", d => {
                if (d.isStart) return "#28a745"; // Green for start
                if (d.isEnding) return "#dc3545"; // Red for ending
                if (d.isChoice) return "#ffc107"; // Yellow for choice
                return "#007bff"; // Blue for standard
            });

        node.append("text")
            .attr("x", 18)
            .attr("y", "0.31em")
            .text(d => d.title.length > 20 ? d.title.substring(0, 20) + '...' : d.title)
            .clone(true).lower()
            .attr("stroke-linejoin", "round")
            .attr("stroke-width", 3)
            .attr("stroke", "white");

        const tooltip = d3.select("#tooltip");

        node.on("mouseover", (event, d) => {
            tooltip.transition().duration(200).style("opacity", .95);
            tooltip.html(`<strong>ID:</strong> ${d.id}<br><strong>Title:</strong> ${d.title}<br><strong>Text:</strong> ${d.text}`)
                .style("left", (event.pageX + 15) + "px")
                .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", () => {
            tooltip.transition().duration(500).style("opacity", 0);
        });

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("transform", d => `translate(${d.x},${d.y})`);
        });

        function drag(simulation) {
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }

            return d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            const newWidth = window.innerWidth;
            const newHeight = window.innerHeight;
            svg.attr('width', newWidth).attr('height', newHeight);
            simulation.force('center', d3.forceCenter(newWidth / 2, newHeight / 2));
            simulation.alpha(0.3).restart();
        });

    </script>
</body>
</html>
