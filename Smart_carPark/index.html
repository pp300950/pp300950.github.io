<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á Smart Car Park</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');

body {
    font-family: 'Sarabun', sans-serif;
    background-color: #f0f2f5;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    color: #333;
    line-height: 1.6;
}

.container {
    background-color: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 450px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏•‡∏¥‡∏õ */
    text-align: center;
    box-sizing: border-box; /* ‡∏£‡∏ß‡∏° padding ‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
}

h1, h2, h3, h4 {
    color: #0056b3;
    margin-top: 0;
    margin-bottom: 1rem;
}

h1 { font-size: 2.2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.5rem; }
h4 { font-size: 1.3rem; }

input[type="text"], input[type="number"] {
    width: calc(100% - 22px); /* ‡∏•‡∏ö border ‡∏≠‡∏≠‡∏Å */
    padding: 10px;
    margin-bottom: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    box-sizing: border-box; /* ‡∏£‡∏ß‡∏° padding ‡πÅ‡∏•‡∏∞ border ‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
}

button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: bold;
    transition: background-color 0.3s;
    margin-top: 0.5rem; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
}

button:hover {
    background-color: #0056b3;
}

#parking-spots {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    gap: 10px;
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.spot {
    background-color: #28a745;
    padding: 20px 10px;
    font-size: 1.1rem;
    font-weight: bold;
}

.spot:hover {
    background-color: #218838;
}

.spot.occupied {
    background-color: #dc3545; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á */
    cursor: not-allowed;
    opacity: 0.7;
}

.spot.occupied:hover {
    background-color: #c82333;
}

.hidden {
    display: none;
}

.parked-info {
    text-align: left;
    background-color: #e9ecef;
    padding: 15px;
    border-radius: 8px;
    margin: 1.5rem 0;
}

.parked-info p {
    margin: 8px 0;
}

.small-text {
    font-size: 0.85rem;
    color: #666;
    margin-top: -0.5rem;
    margin-bottom: 1.5rem;
}

/* --- Receipt Styling --- */
.receipt {
    border: 1px dashed #999;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    background-color: #fefefe;
    text-align: center;
    border-radius: 8px;
}

.receipt-header {
    margin-bottom: 1.5rem;
}

.buu-logo {
    width: 80px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
    margin-bottom: 10px;
}

.receipt-header h3 {
    margin-bottom: 5px;
    color: #0056b3;
}

.receipt-header p {
    font-size: 0.9rem;
    color: #555;
    margin: 0;
}

.receipt-header hr {
    border: 0;
    border-top: 1px dashed #ccc;
    margin: 1rem 0;
}

.receipt-header h4 {
    color: #333;
    font-weight: bold;
    margin-bottom: 1.5rem;
}

#qrcode {
    display: flex;
    justify-content: center;
    margin: 1.5rem 0 1rem 0; /* ‡∏õ‡∏£‡∏±‡∏ö margin */
}

#qrcode canvas { /* QR Code ‡∏ñ‡∏π‡∏Å render ‡πÄ‡∏õ‡πá‡∏ô canvas */
    border: 5px solid #eee;
    border-radius: 8px;
}

.qr-label {
    font-size: 0.95rem;
    font-weight: bold;
    color: #444;
    margin-bottom: 1.5rem;
}

.receipt-details {
    text-align: left;
    margin-bottom: 1.5rem;
    padding: 10px;
    border-top: 1px dashed #eee;
    border-bottom: 1px dashed #eee;
}

.receipt-details p {
    margin: 0.6rem 0;
    display: flex;
    justify-content: space-between;
}

.receipt-details p strong {
    flex-basis: 35%;
}

.receipt-details p span {
    flex-basis: 60%;
    text-align: right;
}

.total-cost {
    font-size: 1.3rem;
    font-weight: bold;
    color: #d9534f; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° */
    margin-top: 1.5rem !important;
    border-top: 2px solid #d9534f;
    padding-top: 10px;
}

.receipt-footer {
    font-size: 0.85rem;
    color: #777;
    margin-top: 2rem;
}

.receipt-footer p {
    margin: 5px 0;
}

.receipt-actions {
    margin-top: 1.5rem;
    display: flex;
    flex-wrap: wrap; /* ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ */
    justify-content: center;
    gap: 10px;
}

.receipt-actions button {
    flex-grow: 1;
    min-width: 150px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° */
}

#payment-status {
    margin-top: 1.5rem;
    padding: 1rem;
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
    border-radius: 8px;
}

.gate-open {
    font-size: 1.2rem;
    font-weight: bold;
    margin-top: 0.5rem;
}

.pay-btn {
    background-color: #28a745;
}
.pay-btn:hover {
    background-color: #218838;
}

.download-btn {
    background-color: #6c757d;
}
.download-btn:hover {
    background-color: #5a6268;
}

.reset-btn {
    background-color: #007bff;
    margin-top: 1rem;
}
.reset-btn:hover {
    background-color: #0056b3;
}

label {
    display: block;
    text-align: left;
    margin-bottom: 0.5rem;
    font-weight: bold;
    color: #555;
}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

    <div class="container">
        <div id="entry-screen">
            <h1>üÖøÔ∏è Smart Car Park</h1>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î</p>
            <input type="text" id="license-plate" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1‡∏Å‡∏Ç 4567" maxlength="10">
            <div id="parking-spots">
                <button class="spot" data-spot="A1">A1</button>
                <button class="spot" data-spot="A2">A2</button>
                <button class="spot" data-spot="A3">A3</button>
                <button class="spot" data-spot="B1">B1</button>
                <button class="spot" data-spot="B2">B2</button>
                <button class="spot" data-spot="B3">B3</button>
            </div>
        </div>

        <div id="time-screen" class="hidden">
            <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏î</h2>
            <p>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: <strong id="display-plate-time"></strong></p>
            <p>‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î: <strong id="display-spot-time"></strong></p>
            <label for="parking-hours">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (1 ‡∏ä‡∏°. = 15 ‡∏ö‡∏≤‡∏ó):</label>
            <input type="number" id="parking-hours" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1.5 (1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á)" min="0.1" step="0.1">
            <button id="confirm-time-btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</button>
        </div>

        <div id="waiting-screen" class="hidden">
            <h2>‚úÖ ‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</h2>
            <div class="parked-info">
                <p><strong>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</strong> <span id="info-plate"></span></p>
                <p><strong>‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î:</strong> <span id="info-spot"></span></p>
                <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î:</strong> <span id="info-time"></span> ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</p>
                <p><strong>‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:</strong> <span id="info-cost"></span> ‡∏ö‡∏≤‡∏ó</p>
            </div>
            <p class="small-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î "‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å" ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î</p>
            <button id="exit-btn">‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</button>
        </div>

        <div id="receipt-screen" class="hidden">
            <div class="receipt" id="receipt-content">
                <div class="receipt-header">
                    <img src="https://www.minigoldroof.com/wp-content/uploads/2018/10/buu.jpg" alt="BUU Logo" class="buu-logo">
                    <h3>‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ö‡∏π‡∏£‡∏û‡∏≤</h3>
                    <p>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 169 ‡∏ñ.‡∏•‡∏á‡∏´‡∏≤‡∏î‡∏ö‡∏≤‡∏á‡πÅ‡∏™‡∏ô ‡∏ï.‡πÅ‡∏™‡∏ô‡∏™‡∏∏‡∏Ç ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ 20131</p>
                    <p>‡πÇ‡∏ó‡∏£. 038-102-xxx</p>
                    <hr>
                    <h4>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô / ‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h4>
                </div>
                
                <div id="qrcode"></div>
                <p class="qr-label">‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>

                <div class="receipt-details">
                    <p><strong>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</strong> <span id="receipt-plate"></span></p>
                    <p><strong>‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î:</strong> <span id="receipt-spot-detail"></span></p>
                    <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î:</strong> <span id="receipt-parking-duration"></span></p>
                    <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤:</strong> <span id="receipt-entry-date"></span></p>
                    <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤:</strong> <span id="receipt-entry-time"></span></p>
                    <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏±‡πã‡∏ß:</strong> <span id="receipt-ticket-id"></span></p>
                    <p class="total-cost"><strong>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞:</strong> <span id="receipt-total-cost"></span> ‡∏ö‡∏≤‡∏ó</p>
                </div>
                <div class="receipt-footer">
                    <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</p>
                    <p>‡πÇ‡∏õ‡∏£‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</p>
                </div>
            </div>
            <div class="receipt-actions">
                <div id="payment-status" class="hidden">
                    <h4>‚úÖ ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
                    <p class="gate-open">‡πÑ‡∏°‡πâ‡∏Å‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß ‚¨ÜÔ∏è</p>
                    <button class="reset-btn" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
                </div>
                <button id="pay-now-btn" class="pay-btn">‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
                <button id="download-jpg-btn" class="download-btn">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î JPG</button>
                <button id="download-pdf-btn" class="download-btn">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    // --- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
    const carData = {
        plate: '',
        spot: '',
        hours: 0,
        cost: 0,
        ticketId: '',
        entryDateTime: null // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≠‡∏î
    };

    // --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÜ ---
    const entryScreen = document.getElementById('entry-screen');
    const timeScreen = document.getElementById('time-screen');
    const waitingScreen = document.getElementById('waiting-screen');
    const receiptScreen = document.getElementById('receipt-screen');
    const receiptContent = document.getElementById('receipt-content'); // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î

    // --- Input ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ---
    const licensePlateInput = document.getElementById('license-plate');
    const parkingSpots = document.querySelectorAll('.spot');
    const confirmTimeBtn = document.getElementById('confirm-time-btn');
    const parkingHoursInput = document.getElementById('parking-hours');
    const exitBtn = document.getElementById('exit-btn');
    const qrcodeContainer = document.getElementById('qrcode');
    const payNowBtn = document.getElementById('pay-now-btn');
    const paymentStatus = document.getElementById('payment-status');
    const downloadJpgBtn = document.getElementById('download-jpg-btn');
    const downloadPdfBtn = document.getElementById('download-pdf-btn');

    // --- Event Listener ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î ---
    parkingSpots.forEach(spot => {
        spot.addEventListener('click', () => {
            if (spot.classList.contains('occupied')) {
                alert('‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≠‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
                return;
            }

            const plate = licensePlateInput.value.trim();
            if (!plate) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
                return;
            }
            carData.plate = plate;
            carData.spot = spot.dataset.spot;
            carData.entryDateTime = new Date(); // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≠‡∏î

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
            document.getElementById('display-plate-time').textContent = carData.plate;
            document.getElementById('display-spot-time').textContent = carData.spot;
            
            // ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            entryScreen.classList.add('hidden');
            timeScreen.classList.remove('hidden');
            
            // Mark spot as occupied (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
            spot.classList.add('occupied');
        });
    });

    // --- Event Listener ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ---
    confirmTimeBtn.addEventListener('click', () => {
        const hours = parseFloat(parkingHoursInput.value);
        if (isNaN(hours) || hours <= 0) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)');
            return;
        }
        
        carData.hours = hours;
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£: 15 ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏°. ‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
        carData.cost = Math.ceil(carData.hours * 15);
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≠
        document.getElementById('info-plate').textContent = carData.plate;
        document.getElementById('info-spot').textContent = carData.spot;
        document.getElementById('info-time').textContent = carData.hours;
        document.getElementById('info-cost').textContent = carData.cost;

        // ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        timeScreen.classList.add('hidden');
        waitingScreen.classList.remove('hidden');
    });
    
    // --- Event Listener ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° '‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å' ---
    exitBtn.addEventListener('click', () => {
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Ticket ID
        carData.ticketId = `BUU-${Date.now().toString().slice(-6)}`; // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Ticket ID ‡∏™‡∏±‡πâ‡∏ô‡πÜ
        
        // ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏•‡∏¥‡∏õ
        const totalMinutes = Math.round(carData.hours * 60);
        const entryDate = carData.entryDateTime.toLocaleDateString('th-TH');
        const entryTime = carData.entryDateTime.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô‡∏™‡∏•‡∏¥‡∏õ
        document.getElementById('receipt-plate').textContent = carData.plate;
        document.getElementById('receipt-spot-detail').textContent = carData.spot;
        document.getElementById('receipt-parking-duration').textContent = `${totalMinutes} ‡∏ô‡∏≤‡∏ó‡∏µ (${carData.hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)`;
        document.getElementById('receipt-entry-date').textContent = entryDate;
        document.getElementById('receipt-entry-time').textContent = entryTime;
        document.getElementById('receipt-ticket-id').textContent = carData.ticketId;
        document.getElementById('receipt-total-cost').textContent = carData.cost.toFixed(2);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á URL ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
        qrcodeContainer.innerHTML = ''; 
        const qrPaymentURL = `http://www.BUU_Car_park/${carData.ticketId}?amount=${carData.cost}&plate=${carData.plate}`;

        new QRCode(qrcodeContainer, {
            text: qrPaymentURL,
            width: 180,
            height: 180,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });

        // ‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        waitingScreen.classList.add('hidden');
        receiptScreen.classList.remove('hidden');

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
        paymentStatus.classList.add('hidden');
        payNowBtn.classList.remove('hidden');
    });

    // --- ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ---
    payNowBtn.addEventListener('click', () => {
        alert(`‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ${carData.cost} ‡∏ö‡∏≤‡∏ó ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ${carData.plate} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!`);
        paymentStatus.classList.remove('hidden');
        payNowBtn.classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß
    });

    // --- ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏õ‡πá‡∏ô JPG ---
    downloadJpgBtn.addEventListener('click', () => {
        html2canvas(receiptContent, { 
            scale: 2, // ‡πÄ‡∏û‡∏¥‡πà‡∏° scale ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏Ñ‡∏°‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
            useCORS: true // ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏•‡πÇ‡∏Å‡πâ
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `receipt_${carData.ticketId}.jpg`;
            link.href = canvas.toDataURL('image/jpeg', 0.9); // 0.9 ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á JPG
            link.click();
        });
    });

    // --- ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏õ‡πá‡∏ô PDF ---
    downloadPdfBtn.addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        html2canvas(receiptContent, { 
            scale: 2, 
            useCORS: true 
        }).then(canvas => {
            const imgData = canvas.toDataURL('image/jpeg', 1.0);
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'px',
                format: [receiptContent.offsetWidth, receiptContent.offsetHeight] // ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î PDF
            });
            pdf.addImage(imgData, 'JPEG', 0, 0, receiptContent.offsetWidth, receiptContent.offsetHeight);
            pdf.save(`receipt_${carData.ticketId}.pdf`);
        });
    });
});
    </script>
</body>
</html>