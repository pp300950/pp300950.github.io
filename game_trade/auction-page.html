<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: #0073e6;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .icon {
            font-size: 24px;
            cursor: pointer;
        }

        .balance {
            font-size: 18px;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #auctionItem {
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #auctionItem img {
            width: 300px;
            height: 300px;
            object-fit: contain;
        }

        #itemDescription {
            margin: 10px 0;
            font-size: 18px;
        }

        #currentBid {
            font-size: 24px;
            color: green;
            margin-bottom: 10px;
        }

        #bidControls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        #bidInput {
            width: 80px;
            text-align: center;
            font-size: 20px;
            margin: 0 10px;
        }

        #confirmBid {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #biddersList {
            margin-top: 20px;
            width: 80%;
            max-width: 600px;
        }

        .bidder {
            display: flex;
            justify-content: space-between;
            padding: 5px;
            background-color: #dadada;

            margin: 5px 0;
        }

        #timer {
            font-size: 20px;
            color: red;
            margin-top: 20px;
        }

        /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏• */
        #participantsCount {
            position: fixed;
            top: 85px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 16px;
            z-index: 1000;
        }

        #chatContainer {
            display: none;
            position: fixed;
            bottom: 0;
            right: 0;
            top: 75px;
            background-color: white;
            border: 1px solid #ccc;
            width: 100vw;
            height: 60vh;
            max-width: 400px;
            max-height: 500px;
            z-index: 1000;
        }

        #chatBox {
            width: 100%;
            height: 80%;
            overflow-y: auto;
            padding: 10px;
            border-bottom: 1px solid #ccc;
            display: flex;
            flex-direction: column;
        }

        #chatInput {
            width: calc(100% - 50px);
            padding: 10px;
            box-sizing: border-box;
            margin-right: 10px;
        }

        #sendButton {
            padding: 20px;
            cursor: pointer;
            background-color: rgb(53, 92, 219);
            color: rgb(255, 255, 255);
            border: none;
            border-radius: 15px;
        }

        .user-message {
            align-self: flex-end;
            background-color: #e1f7d5;
            margin: 5px 0;
            padding: 10px;
            border-radius: 10px;
            max-width: 70%;
            margin-right: 20px;
        }

        .other-message {
            align-self: flex-start;
            background-color: #f1f0f0;
            margin: 5px 0;
            padding: 10px;
            border-radius: 10px;
            max-width: 70%;
        }

        .other-message-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            margin-left: 10px;
        }

        .profile-pic {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
    </style>
</head>

<body>
    <header>
        <span class="icon" id="chat"">üí¨ ‡πÅ‡∏ä‡∏ó</span>
        <span class=" icon" onclick="goHome()">üè† ‡πÇ‡∏Æ‡∏°</span>
        <script>
            function goHome() {
                window.location.href = 'Home.html';
            }
        </script>
        <span class="balance">üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span id="userBalance">0</span> ‡∏ö‡∏≤‡∏ó</span>
    </header>

    <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏• -->
    <div id="participantsCount">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•: <span id="numParticipants">0</span></div>
    <div id="loadingMessage" style="display: block; font-size: xx-large; color: #28a745;margin-top: 60px;">
        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà <div id="auction-timer" style="display: inline;color: #ff2828; font-size: xx-large;">0</div>
        ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...</div>
    <div id="loadingMessage2" style="display: none;  font-size: xx-large;
     color: #a7289c;margin-top: 60px; text-align: center;">
        +++ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏à‡∏£‡πâ‡∏≤ +++
    </div>

    <div id="chatContainer">
        <div id="chatBox"></div>
        <div style="display: flex; align-items: center;">
            <input type="text" id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
            <button id="sendButton">‡∏™‡πà‡∏á</button>
        </div>
    </div>

    <main>
        <div id="auctionItem">
            <img src="https://via.placeholder.com/300" alt="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•" id="pictur">
            <div id="itemDescription">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
            <div id="details">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏ö‡∏•‡∏≤‡πÜ‡πÜ‡πÜ</div>
            <div id="minbid">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: 0 ‡∏ö‡∏≤‡∏ó</div>
            <div id="currentBid">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="currentBidValue">0</span> ‡∏ö‡∏≤‡∏ó</div>

            <div id="bidControls">
                <button onclick="changeBid(-10)">üîΩ ‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤</button>
                <input type="number" id="bidInput" value="10" readonly>
                <button onclick="changeBid(10)">üîº ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤</button>
                <button id="confirmBid" style="margin-left: 10px;">‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•</button>
            </div>
            <div id="timer">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="timeLeft">0</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>
        </div>

        <div id="biddersList">
            <h3>‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•</h3>
            <div id="bidders"></div>
        </div>
    </main>

    <script>
        let currentBid = parseInt(bidInput.value);

        function changeBid(amount) {
            const bidInput = document.getElementById('bidInput');
            let a = currentBid + amount; //‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï = ‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô + ‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô (+10 ‡∏´‡∏£‡∏∑‡∏≠ -10)
            if (a > 0) { //‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 1
                currentBid += amount;
                bidInput.value = currentBid;
            } else {
                alert('‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 10 ‡∏ö‡∏≤‡∏ó');
            }
            console.log("‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: " + currentBid)
        }


    </script>
    <script type="module" defer>

        import { initializeApp, } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, fetchSignInMethodsForEmail } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-auth.js";
        import {
            getFirestore, collection, addDoc, where, setDoc, serverTimestamp, getDocs, getDoc, doc,
            updateDoc, query, orderBy, onSnapshot
        } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-firestore.js";
        import { getStorage, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-storage.js"; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Firebase Storage API
        import { getDatabase, set, push, ref, onValue, remove, get, child } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDVzawA_NDnkqCHKerT2Gcg4zO9yohWx3U",
            authDomain: "pangpone-1372b.firebaseapp.com",
            databaseURL: "https://pangpone-1372b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pangpone-1372b",
            storageBucket: "pangpone-1372b.appspot.com",
            messagingSenderId: "911442011016",
            appId: "1:911442011016:web:8434ea79964ceab63a903d",
            measurementId: "G-S144W2V9SG"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const firestore = getFirestore(app);
        const storage = getStorage(app);
        const getdata = getDatabase(app);

        let statusbid = false;
        let add_once = false;
        let status_time = false;
        let bidstat = false;
        let totalBids = 0;
        let newtotal = 0;
        let temp_value = 0;
        let newtotal_temp = 0;
        let countdown; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡πá‡∏ö interval ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà  ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
        let userE;
        let bid3 = true;
        let state_end = false;

        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.style.display = chatContainer.style.display === 'none' ? 'block' : 'none';

            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            if (chatContainer.style.display === 'block') {
                const chatBox = document.getElementById('chatBox');
                chatBox.scrollTop = chatBox.scrollHeight; // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            }
        }

        function sendMessage() {
            const userEmail = localStorage.getItem('userEmail') || "";
            const chatBox = document.getElementById('chatBox');
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();

            if (message) {
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Firebase
                set(push(ref(getdata, 'chat')), {
                    user: userEmail,
                    msg: message,
                    timestamp: Date.now() // ‡πÉ‡∏ä‡πâ Date.now() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö millisecond
                });

                chatInput.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

                // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        
let lastUserEmail = null; 
let messages = []; 

async function displayMessage(userEmail, message, timestamp) {
    const chatBox = document.getElementById('chatBox');
    const currentUserEmail = localStorage.getItem('userEmail');

    let username;
    let profileImageUrl;

    try {
        const userQuery = query(collection(db, 'usersgame'), where('email', '==', userEmail));
        const querySnapshot = await getDocs(userQuery);

        if (!querySnapshot.empty) {
            querySnapshot.forEach(doc => {
                const userData2 = doc.data();
                username = userData2.username;
                profileImageUrl = userData2.picture;
            });
        } else {
            console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ');
            return;
        }
    } catch (error) {
        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', error);
        return;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö userEmail ‡πÅ‡∏•‡∏∞ timestamp ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô messages ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (!messages.some(msg => msg.userEmail === userEmail && msg.timestamp === timestamp)) {
        messages.push({ userEmail, message, timestamp, username, profileImageUrl });
        messages.sort((a, b) => a.timestamp - b.timestamp);

        chatBox.innerHTML = '';

        messages.forEach(msg => {
    const messageElement = document.createElement('div');

    if (msg.userEmail === currentUserEmail) {
        messageElement.className = 'user-message';
        messageElement.textContent = msg.message;
    } else {
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á element ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á otherMessageContainer
        const usernameElement = document.createElement('div');
        usernameElement.className = 'other-user';
        usernameElement.style.marginBottom = '5px'; 
        usernameElement.textContent = msg.username;
        usernameElement.style.marginLeft = '15px'; 

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        const otherMessageContainer = document.createElement('div');
        otherMessageContainer.className = 'other-message-container';

        const profilePic = document.createElement('img');
        profilePic.src = msg.profileImageUrl || 'defaultProfilePic.png';
        profilePic.className = 'profile-pic';
        profilePic.alt = `${msg.username}'s profile picture`;

        const otherMessage = document.createElement('div');
        otherMessage.className = 'other-message';
        otherMessage.textContent = msg.message;

        otherMessageContainer.appendChild(profilePic);
        otherMessageContainer.appendChild(otherMessage);

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° usernameElement ‡πÅ‡∏•‡∏∞ otherMessageContainer ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô chatBox ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
        chatBox.appendChild(usernameElement);
        chatBox.appendChild(otherMessageContainer);
    }

    chatBox.appendChild(messageElement);
    lastUserEmail = msg.userEmail;
});


        chatBox.scrollTop = chatBox.scrollHeight;
    }
}

function loadChatMessages() {
    const chatBox = document.getElementById('chatBox');

    const chatRef = ref(getdata, 'chat');
    onValue(chatRef, (snapshot) => {
        let newMessages = [];

        snapshot.forEach((childSnapshot) => {
            const childData = childSnapshot.val();
            if (!messages.some(msg => msg.userEmail === childData.user && msg.timestamp === childData.timestamp)) {
                newMessages.push(childData);
            }
        });

        newMessages.sort((a, b) => a.timestamp - b.timestamp);

        newMessages.forEach((childData) => {
            displayMessage(childData.user, childData.msg, childData.timestamp);
        });

        chatBox.scrollTop = chatBox.scrollHeight;
    });
}




        // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listeners ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î
        document.addEventListener('DOMContentLoaded', () => {
            const chatToggle = document.getElementById('chat');
            const sendButton = document.getElementById('sendButton');

            chatToggle.addEventListener('click', toggleChat);
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', sendMessage1);

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ä‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            loadChatMessages();
        });

        function sendMessage1(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }








        async function clearBidData() {
            try {
                await remove(ref(getdata, 'bid'));
                await remove(ref(getdata, 'countall'));
            } catch (error) {
                console.error('Error clearing bid data:', error);
            }
        }

        async function confirmBid() {
            if (statusbid) {
                let bidInputValue = parseInt(document.getElementById('bidInput').value);

                const userEmail = localStorage.getItem('userEmail');

                set(push(ref(getdata, 'bid')), {
                    user: userEmail,
                    bid: bidInputValue
                });

            } else if (!bid3) {
                alert("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•");
            } else {
                alert("‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•")
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
        function startTimer(duration, display) {
            const userEmail = localStorage.getItem('userEmail') || "";
            if (status_time) {
                bidstat = true;
                let timers = duration, seconds;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                if (countdown) {
                    clearInterval(countdown);
                }

                countdown = setInterval(async function () {
                    seconds = parseInt(timers, 10);

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                    display.textContent = seconds;

                    if (--timers < 0) {
                        clearInterval(countdown);
                        bid3 = false;
                        state_end = true;

                        await addItemToBag();
                        requestNewProduct();
                        clearBidData();
                        alert("‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏• ‡∏Ç‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å");
                    }
                }, 1000);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏•‡∏á‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤
        async function addItemToBag() {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
            const userEmail = localStorage.getItem('userEmail');
            let img = localStorage.getItem('img');
            let name = localStorage.getItem('name');
            let bid = localStorage.getItem('bid');
            let details = localStorage.getItem('details');

            let addforWinUser = {
                name: name,
                description: details,
                image: img,
                price: bid,
                bid: newtotal,
                date: new Date() // ‡πÉ‡∏ä‡πâ timestamp ‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡πÑ‡∏Ñ‡∏•‡πÄ‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏ó‡∏ô
            };

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
            if (userE === userEmail) {

                console.log("‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")

                const userRef = collection(db, "usersgame");
                const querySnapshot = await getDocs(query(userRef, where("email", "==", userEmail)));

                if (!querySnapshot.empty) {
                    querySnapshot.forEach(async (doc) => {
                        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• bag ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                        let currentBag = doc.data().bag || [];
                        let currentMoney = doc.data().money || 0;

                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÑ‡∏õ
                        currentBag.push(addforWinUser);
                        let updatedMoney = currentMoney - newtotal;

                        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ïbag‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        await updateDoc(doc.ref, {
                            bag: currentBag,
                            money: updatedMoney // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏á‡∏¥‡∏ô
                        });

                        console.log("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï bag ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    });
                } else {
                    console.log("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ");
                }
            } else {
                console.log(" ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏• ")
            }
        }

        async function requestNewProduct() {
            const userEmail = localStorage.getItem('userEmail');
            let bid = localStorage.getItem('bid');
            let userMoney = localStorage.getItem('userMoney');

            const response = await fetch('auction.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    status: 'red',
                    user_email: userEmail,
                    user_money: userMoney,
                    min_bid: bid
                })
            });
        }

        function startTimer2(duration, display) {
            let timers = duration, seconds;

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
            if (countdown) {
                clearInterval(countdown);
            }

            countdown = setInterval(async function () {
                if (!bidstat) {
                    seconds = parseInt(timers, 10);

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                    display.textContent = seconds;

                    // ‡∏ñ‡πâ‡∏≤‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à (0 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
                    if (--timers < 0) {
                        clearInterval(countdown);
                        requestNewProduct();
                        clearBidData();
                        wait();
                    }
                } else {
                    clearInterval(countdown); // ‡∏ñ‡πâ‡∏≤ bidstat ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô true ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                }
            }, 1000);
        }

        function backend() {
            let timeLeft2 = 3; // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

            const timer2 = setInterval(() => {
                if (timeLeft2 <= 0) {
                    clearInterval(timer2); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                    loadingMessage2.style.display = 'none';
                } else {
                    timeLeft2--;
                }
            }, 1000);
        }

        function wait() {
            let timeLeft3 = 5; // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

            const timer3 = setInterval(() => {
                if (timeLeft3 <= 0) {
                    clearInterval(timer3); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                    console.log("‡∏Ñ‡∏£‡∏ö5‡∏ß‡∏¥")
                } else {
                    timeLeft3--;
                }
            }, 1000);
        }

        function countStart() {
            const timerDisplay = document.getElementById('auction-timer');
            let timeLeft = 5; // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            status_time = true;

            const timer = setInterval(() => {
                if (timeLeft <= 0) {
                    clearInterval(timer); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
                    loadingMessage.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                    loadingMessage2.style.display = 'block';
                    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    let timeLeftElement = document.getElementById('timeLeft');
                    startTimer2(10, timeLeftElement); // ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡πÄ‡∏£‡∏Å
                    statusbid = true;
                    backend();
                } else {
                    timerDisplay.innerHTML = `${timeLeft}`;
                    timeLeft--;
                }
            }, 1000);
        }

        async function addBidder(userE, bidAmount) {
    let userName = '';
    const biddersList = document.getElementById('bidders');
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ö‡∏¥‡∏î‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    let existingBidder = Array.from(biddersList.children).find(bidder =>
        bidder.querySelector('span').textContent === userE
    );

    if (existingBidder) {
        return;
    }

    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å Firestore ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•
    try {
        const userQuery = query(collection(db, 'usersgame'), where('email', '==', userE));
        const querySnapshot = await getDocs(userQuery);
        if (!querySnapshot.empty) {
            querySnapshot.forEach(doc => {
                const userData2 = doc.data();
                userName = userData2.username;
            });
        } else {
            console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ');
            userName = userE;
        }
    } catch (error) {
        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', error);
        userName = userE;
    }

    let bid = parseInt(localStorage.getItem('bid')) || 0;

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ total ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏¥‡∏î
    let newTotal;
    if (add_once) {
        newTotal = bidAmount + newtotal;
        temp_value = newtotal_temp;
        newtotal_temp = newTotal;
    } else {
        add_once = true;
        newTotal = bidAmount + newtotal + bid;
        newtotal_temp = newTotal;
        temp_value = bid;
    }

    const bidderEntry = {
        userName,
        bidAmount,
        newTotal,
        temp_value
    };

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏¥‡∏î‡∏•‡∏á‡πÉ‡∏ô‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå
    messages.push(bidderEntry);

    // ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå messages ‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏° bidAmount ‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
    messages.sort((a, b) => b.bidAmount - a.bidAmount);

    // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô biddersList ‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    biddersList.innerHTML = '';

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏¥‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° bidAmount
    messages.forEach(msg => {
        const bidderElement = document.createElement('div');
        bidderElement.className = 'bidder';
        bidderElement.innerHTML = `
            <span>${msg.userName}</span>
            <span style="color:red;">${" + " + msg.bidAmount} ‡∏ö‡∏≤‡∏ó</span>
            <span>‡∏ö‡∏¥‡∏î: <span>${msg.temp_value} ‡∏ö‡∏≤‡∏ó</span> 
            <span style="color: green;">${" &#x2192; " + msg.newTotal} ‡∏ö‡∏≤‡∏ó</span>
        `;
        biddersList.appendChild(bidderElement);
    });
}


        document.addEventListener('DOMContentLoaded', async function () {
            const confirmBidButton = document.getElementById('confirmBid');
            confirmBidButton.addEventListener('click', confirmBid);

            let img = localStorage.getItem('img');
            let name = localStorage.getItem('name');
            let bid = localStorage.getItem('bid');
            let userEmail = localStorage.getItem('userEmail');
            let userMoney = localStorage.getItem('userMoney');
            let details = localStorage.getItem('details');

            let bid2 = parseInt(localStorage.getItem('bid')) || 0;

            const itemImage = document.getElementById('itemDescription');
            const pictur = document.getElementById('pictur');
            const userBalance = document.getElementById('userBalance');
            const minbid = document.getElementById('minbid');
            const detail = document.getElementById('details');

            const currentBidDisplay = document.getElementById('currentBidValue');

            itemImage.textContent = name;
            pictur.src = img;
            userBalance.textContent = userMoney;
            minbid.textContent = "‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: " + bid2 + " ‡∏ö‡∏≤‡∏ó";
            detail.textContent = "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: " + details;

            onValue(ref(getdata, 'bid'), (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const biddersList = document.getElementById('bidders');
                    biddersList.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏ö‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô

                    totalBids = Object.values(data).reduce((sum, bid) => sum + (bid.bid || 0), 0);
                    currentBidDisplay.textContent = totalBids + bid2;

                    Object.values(data).forEach(bidInfo => {
                        userE = bidInfo.user;
                        let bidAmount = bidInfo.bid;
                        addBidder(userE, bidAmount); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏ö‡∏¥‡∏î
                    });

                    startTimer(10, document.getElementById('timeLeft'));
                } else {
                    console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô bid');
                }
            });
        });

        /*********************     ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô     ************************/
        document.addEventListener('DOMContentLoaded', async function () {
            let minBid = localStorage.getItem('bid');
            let userMoney = localStorage.getItem('userMoney');
            let countUsers = localStorage.getItem('countUsers');
            const userEmail = localStorage.getItem('userEmail') || "";
            let bid2 = parseInt(localStorage.getItem('bid')) || 0;

            const currentBidDisplay = document.getElementById('currentBidValue');
            const currentBidValue = parseInt(currentBidDisplay.innerText);

            currentBidDisplay.textContent = totalBids + bid2;


            if (userMoney !== null && minBid !== null) {
                console.log("‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•:", countUsers);

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                if (countUsers < 2) {  /********************   ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô 2     ************************/
                    clearBidData();
                    alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 2 ‡∏Ñ‡∏ô');
                    window.location.href = 'Home.html';
                }

                onValue(ref(getdata, 'countall'), (snapshot) => {
                    const data = snapshot.val();
                    let emailExists = false;

                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô snapshot
                    if (data) {
                        // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        for (const key in data) {
                            if (data[key].user === userEmail) {
                                emailExists = true;
                                break;
                            }
                        }
                    }

                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    if (!emailExists) {
                        if (!state_end) {
                            window.location.href = 'Home.html';
                        }
                    } else {
                        countStart();
                    }
                });
            }

            const numParticipants = document.getElementById('numParticipants');
            numParticipants.innerHTML = countUsers;

        });
    </script>
</body>