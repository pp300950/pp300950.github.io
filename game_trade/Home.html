<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            background-color: #333;
            color: white;
            padding: 10px;
            margin-bottom: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info img {
            object-fit: cover;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .money-info {
            color: yellow;
            display: flex;
            align-items: center;
            font-size: 24px;
        }

        .money-info i {
            margin-left: 5px;
            font-size: 30px;
        }

        .gear-icon {
            cursor: pointer;
            font-size: x-large;
        }

        .content {
            padding: 20px;
        }

        .shop,
        .auction,
        .inventory {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
        }

        .shop-item,
        .auction-item,
        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .shop-item img,
        .auction-item img,
        .inventory-item img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }

        .shop-item .details,
        .auction-item .details,
        .inventory-item .details {
            flex-grow: 1;
        }

        @media only screen and (max-width: 425px) {

            .shop-item,
            .auction-item {
                flex-direction: column;
            }

            .price-btn-container,
            .auction-item {
                flex-direction: column;
                align-items: stretch;
            }

            .btn,
            .auction-item {
                margin-top: 10px;
                width: 90%;
            }
        }

        .btn {
            padding: 5px 10px;
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            margin-left: 20px;
        }

        .btn:hover {
            font-size: large;
        }

        .btn.disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .hidden {
            display: none;
        }

        #notification {
            background-color: red;
            color: white;
            padding: 10px;
            position: fixed;
            top: 20px;
            right: 20px;
            display: none;
            border-radius: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
        }

        .modal-content {
            z-index: 999;
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 5px solid #96896e;
            width: 80%;
            border-radius: 5px;
        }

        .close,
        .closec {
            color: #ff2828;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus,
        .closechat:hover,
        .closechat:focus,
        .closec:hover,
        .closec:focus {
            color: rgb(136, 31, 31);
            text-decoration: none;
            cursor: pointer;
        }

        /* CSS Styles for Profile Picture Preview */
        #profilePicPreview,
        #profileUser {
            display: block;
            text-align: center;
            width: 100px;
            height: 100px;
            margin: 20px auto;
            border-radius: 50%;
            object-fit: cover;
        }

        .save {
            height: 40px;
            width: 20%;
            border: none;
            border-radius: 15px;
            background-color: #4caf50;
            color: white;
            cursor: pointer;
            transition: 0.7s;
        }

        .save:hover {
            width: 40%;
        }

        #editProfileForm {
            text-align: center;
        }

        .modal {
            display: flex;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        .hidden {
            display: none;
            text-align: center;

        }

        #full-screen-image {
            height: 300px;
            width: 300px;
        }

        .inventory-item {
            background-color: #f0f0f0;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }

        .inventory-item img {
            border-radius: 10px;
            margin-right: 15px;
        }

        .inventory-item .details {
            flex: 1;
        }

        .shop-item {
            background-color: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }

        .shop-item img {
            border-radius: 8px;
            margin-right: 15px;
        }

        .shop-item .details {
            flex: 1;
        }

        .shop-item .btn {
            background-color: #ff6666;
            border: none;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }

        .shop-item .btn:hover {
            background-color: #ff4d4d;
        }

        #rankButton {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        #rankButton:hover {
            background-color: #45a049;
        }

        #rankingTableContainer {
            margin: 20px;
            font-family: Arial, sans-serif;
        }

        #rankingTable {
            width: 100%;
            border-collapse: collapse;
            background-color: #f9f9f9;
        }

        #rankingTable th,
        #rankingTable td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        #rankingTable th {
            background-color: #4CAF50;
            color: white;
        }

        #rankingTable tr:hover {
            background-color: #f1f1f1;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {

            #rankingTable th,
            #rankingTable td {
                padding: 8px;
                font-size: 14px;
            }

            #rankingTable th {
                font-size: 16px;
            }

            #rankButton {
                padding: 3px 7px;
                font-size: 12px;

            }

            .money-info,
            i {
                font-size: small;
                margin-left: 2%;
            }

            #logout-button,
            #editProfileBtn {
                display: block;
            }

            #icon {
                font-size: small;
                cursor: pointer;
            }
        }

        #chatContainer {
            display: none;
            position: fixed;
            bottom: 0;
            right: 0;
            top: 75px;
            background-color: white;
            border: 1px solid #ccc;
            width: 100vw;
            height: 60vh;
            max-width: 400px;
            max-height: 500px;
            z-index: 1000;
        }

        #chatBox {
            width: 100%;
            height: 80%;
            overflow-y: auto;
            padding: 10px;
            border-bottom: 1px solid #ccc;
            display: flex;
            flex-direction: column;
        }

        #chatInput {
            width: calc(100% - 50px);
            padding: 10px;
            box-sizing: border-box;
            margin-right: 10px;
        }

        #sendButton {
            padding: 20px;
            cursor: pointer;
            background-color: rgb(53, 92, 219);
            color: rgb(255, 255, 255);
            border: none;
            border-radius: 15px;
        }

        .user-message {
            align-self: flex-end;
            background-color: #e1f7d5;
            margin: 5px 0;
            padding: 10px;
            border-radius: 10px;
            max-width: 70%;
            margin-right: 20px;
        }

        .other-message {
            align-self: flex-start;
            background-color: #f1f0f0;
            margin: 5px 0;
            padding: 10px;
            border-radius: 10px;
            max-width: 70%;
        }

        .other-message-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            margin-left: 10px;
        }

        .profile-pic {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
        #chat{
            font-size: larger;
            background-color: #f1f1f1;
            border-radius: 15px;
            padding: 10px 15px;
            margin: 10px;
            cursor: pointer;
        }

        @media (max-width: 540px) {
            #chatContainer {

            top: 125px;
           
        }
        }
    </style>
</head>

<body>
    <script src="https://kit.fontawesome.com/1e0e692548.js" crossorigin="anonymous"></script>

    <!-- ‡πÅ‡∏ñ‡∏ö‡∏ö‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô -->
    <div class="top-bar">
        <div class="user-info">
            <img id="picU" src="" alt="Profile">
            <div id="nameU">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
        </div>
        <div class="money-info">
            <span id="money">0</span> ‡∏ö‡∏≤‡∏ó
            <i class="fas fa-coins" id="icon"></i>
        </div>

        <div style="white-space: nowrap;">
            <button id="rankButton" onclick="toggleItems2()">‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</button>
            <div class="gear-icon" id="editProfileBtn" style="display: inline-block; margin: 0 10px 0 10px; ">
                <i class="fas fa-cog"></i>
            </div>
            <button id="logout-button"
                style=" padding: 5px; border: none;  border-radius: 15px;  background-color: #ff4d4d;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>
    <span class="icon" id="chat"">üí¨ ‡πÅ‡∏ä‡∏ó</span>
    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        function logout() {
            // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏à‡∏≤‡∏Å localStorage
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userMoney');

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
            window.location.href = 'login.html'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°
        document.getElementById('logout-button').addEventListener('click', logout);

    </script>
    <div id="chatContainer">
        <div id="chatBox"></div>
        <div style="display: flex; align-items: center;">
            <input type="text" id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
            <button id="sendButton">‡∏™‡πà‡∏á</button>
        </div>
    </div>

    
    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö -->
    <div id="rankingTableContainer" class="hidden">
        <script>
            function toggleItems2() {
                const moreItems2 = document.getElementById("rankingTable");
                if (moreItems2.classList.contains("hidden")) {
                    moreItems2.classList.remove("hidden");
                } else {
                    moreItems2.classList.add("hidden");
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                toggleItems2();
            });

        </script>
        <table id="rankingTable" border="1">
            <thead>
                <tr>
                    <th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                    <th>‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="editProfileModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
            <div class="container2">
                <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h2>
                <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
                <form id="editProfileForm">
                    <img src="" id="profilePicPreview" alt="Profile Picture Preview">
                    <input type="file" id="profilePicInput" accept="image/*" style="display: none;">

                    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
                    <label for="username" style="font-size: larger;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ :</label>
                    <input type="text" id="usernamePreview" name="username"></input>
                    <h4 id="userID"></h4>
                    <h4 id="email"></h4>
                    <h4 id="date"></h4>
                    <input type="submit" value="Save" id="save" class="save"></input>
                </form>
            </div>
        </div>
    </div>

    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
    <div class="content">
        <!-- ‡πÅ‡∏ñ‡∏ö‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ -->
        <div class="shop">
            <h2>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <div id="shop-items">
                <!-- ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
            <div id="more-items" class="hidden">
                <!-- ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
            <script>
                function toggleItems() {
                    const moreItems = document.getElementById("more-items");
                    if (moreItems.classList.contains("hidden")) {
                        moreItems.classList.remove("hidden");
                    } else {
                        moreItems.classList.add("hidden");
                    }
                }

                document.addEventListener('DOMContentLoaded', function () {
                    toggleItems();
                });
            </script>

            <button class="btn" onclick="toggleItems()">‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button>
        </div>
        <script>
            // ‡∏Å‡∏î‡∏†‡∏≤‡∏û‡πÄ‡πÄ‡∏•‡πâ‡∏ß‡πÄ‡πÄ‡∏™‡∏î‡∏á
            function openModal(imageSrc) {
                const modal = document.getElementById('full-screen-modal');
                const modalImage = document.getElementById('full-screen-image');
                modalImage.src = imageSrc;
                modal.classList.remove('hidden');
            }

            // ‡∏õ‡∏¥‡∏î‡πÄ‡πÄ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û
            function closeModal() {
                const modal = document.getElementById('full-screen-modal');
                modal.classList.add('hidden');
            }
        </script>

        <!-- ‡∏Å‡∏î‡∏†‡∏≤‡∏û‡πÄ‡πÄ‡∏•‡πâ‡∏ß‡πÄ‡πÄ‡∏™‡∏î‡∏á -->
        <div id="full-screen-modal" class="modal hidden">
            <span class="close" onclick="closeModal()">&times;</span>
            <img class="modal-content" id="full-screen-image">
        </div>

        <!-- ‡πÅ‡∏ñ‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏• -->
        <div class="auction">
            <h2>‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤<div id="userCountDisplay" style="color: #ff2828;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°: 0 ‡∏Ñ‡∏ô</div>
            </h2>
            <div class="auction-item">
                <!-- ‡πÄ‡πÄ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏• -->
            </div>
            <div id="auction-timer" style="color: #ff2828; font-size: xx-large;"></div>
        </div>

        <!-- ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div class="inventory">
            <h2>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
            <div id="total-items"></div>

            <div id="inventory-items">
                <!-- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->

            </div>
        </div>
    </div>

    <!-- ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
    <div id="notification"></div>

    <script type="module" defer>

        import { initializeApp, } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, fetchSignInMethodsForEmail } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-auth.js";
        import {
            getFirestore, collection, addDoc, where, setDoc, serverTimestamp, getDocs, getDoc, doc,
            updateDoc, query, orderBy, onSnapshot
        } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-firestore.js";

        import { getStorage, uploadBytes, ref as storageRef, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-storage.js"; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Firebase Storage API
        import { getDatabase, set, push, ref, onValue, remove, get, child } from "https://www.gstatic.com/firebasejs/9.12.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDVzawA_NDnkqCHKerT2Gcg4zO9yohWx3U",
            authDomain: "pangpone-1372b.firebaseapp.com",
            databaseURL: "https://pangpone-1372b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pangpone-1372b",
            storageBucket: "pangpone-1372b.appspot.com",
            messagingSenderId: "911442011016",
            appId: "1:911442011016:web:8434ea79964ceab63a903d",
            measurementId: "G-S144W2V9SG"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const firestore = getFirestore(app);
        const storage = getStorage(app);
        const getdata = getDatabase(app);

        async function clearBidData() {
            try {
                await remove(ref(getdata, 'bid'));
                await remove(ref(getdata, 'countall'));
            } catch (error) {
                console.error('Error clearing bid data:', error);
            }
        }

        let countUsers = 0;

        function toggleChat() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.style.display = chatContainer.style.display === 'none' ? 'block' : 'none';

            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            if (chatContainer.style.display === 'block') {
                const chatBox = document.getElementById('chatBox');
                chatBox.scrollTop = chatBox.scrollHeight; // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            }
        }

        function sendMessage() {
            const userEmail = localStorage.getItem('userEmail') || "";
            const chatBox = document.getElementById('chatBox');
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();

            if (message) {
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Firebase
                set(push(ref(getdata, 'chat')), {
    user: userEmail,
    msg: message,
    timestamp: Date.now() // ‡πÉ‡∏ä‡πâ Date.now() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö millisecond
});

                chatInput.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

                // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }



let lastUserEmail = null; 
let messages = []; 

async function displayMessage(userEmail, message, timestamp) {
    const chatBox = document.getElementById('chatBox');
    const currentUserEmail = localStorage.getItem('userEmail');

    let username;
    let profileImageUrl;

    try {
        const userQuery = query(collection(db, 'usersgame'), where('email', '==', userEmail));
        const querySnapshot = await getDocs(userQuery);

        if (!querySnapshot.empty) {
            querySnapshot.forEach(doc => {
                const userData2 = doc.data();
                username = userData2.username;
                profileImageUrl = userData2.picture;
            });
        } else {
            console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ');
            return;
        }
    } catch (error) {
        console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', error);
        return;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö userEmail ‡πÅ‡∏•‡∏∞ timestamp ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô messages ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (!messages.some(msg => msg.userEmail === userEmail && msg.timestamp === timestamp)) {
        messages.push({ userEmail, message, timestamp, username, profileImageUrl });
        messages.sort((a, b) => a.timestamp - b.timestamp);

        chatBox.innerHTML = '';

        messages.forEach(msg => {
    const messageElement = document.createElement('div');

    if (msg.userEmail === currentUserEmail) {
        messageElement.className = 'user-message';
        messageElement.textContent = msg.message;
    } else {
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á element ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á otherMessageContainer
        const usernameElement = document.createElement('div');
        usernameElement.className = 'other-user';
        usernameElement.style.marginBottom = '5px'; 
        usernameElement.textContent = msg.username;
        usernameElement.style.marginLeft = '15px'; 

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        const otherMessageContainer = document.createElement('div');
        otherMessageContainer.className = 'other-message-container';

        const profilePic = document.createElement('img');
        profilePic.src = msg.profileImageUrl || 'defaultProfilePic.png';
        profilePic.className = 'profile-pic';
        profilePic.alt = `${msg.username}'s profile picture`;

        const otherMessage = document.createElement('div');
        otherMessage.className = 'other-message';
        otherMessage.textContent = msg.message;

        otherMessageContainer.appendChild(profilePic);
        otherMessageContainer.appendChild(otherMessage);

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° usernameElement ‡πÅ‡∏•‡∏∞ otherMessageContainer ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô chatBox ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
        chatBox.appendChild(usernameElement);
        chatBox.appendChild(otherMessageContainer);
    }

    chatBox.appendChild(messageElement);
    lastUserEmail = msg.userEmail;
});


        chatBox.scrollTop = chatBox.scrollHeight;
    }
}

function loadChatMessages() {
    const chatBox = document.getElementById('chatBox');

    const chatRef = ref(getdata, 'chat');
    onValue(chatRef, (snapshot) => {
        let newMessages = [];

        snapshot.forEach((childSnapshot) => {
            const childData = childSnapshot.val();
            if (!messages.some(msg => msg.userEmail === childData.user && msg.timestamp === childData.timestamp)) {
                newMessages.push(childData);
            }
        });

        newMessages.sort((a, b) => a.timestamp - b.timestamp);

        newMessages.forEach((childData) => {
            displayMessage(childData.user, childData.msg, childData.timestamp);
        });

        chatBox.scrollTop = chatBox.scrollHeight;
    });
}




        // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listeners ‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î
        document.addEventListener('DOMContentLoaded', () => {
            const chatToggle = document.getElementById('chat');
            const sendButton = document.getElementById('sendButton');

            chatToggle.addEventListener('click', toggleChat);
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', sendMessage1);

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ä‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            loadChatMessages();
        });

        function sendMessage1(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }


        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•
        async function loadAuctionItems() {
            try {
                console.log("‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•");
                const dd = localStorage.getItem('name');
                const response = await fetch('auction.php', {
                    method: 'POST', // ‡πÉ‡∏ä‡πâ POST ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    headers: {
                        'Content-Type': 'application/json', // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Content-Type
                    },
                    body: JSON.stringify({ user_email: dd }) // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON
                });

                const resultText = await response.text(); // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                console.log("Raw response:", resultText); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö

                // ‡πÉ‡∏ä‡πâ Regular Expression ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô (‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå‡∏ß‡πà‡∏≤‡∏á)
                const cleanedResultText = resultText.replace(/}\s*{/g, '},{'); // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å JSON ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

                // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á JSON ‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                const jsonParts = cleanedResultText.split('}{');
                const combinedJson = jsonParts.join('},{'); // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                const finalJsonText = `[${combinedJson}]`; // ‡∏™‡∏£‡πâ‡∏≤‡∏á JSON array

                // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå JSON
                const responseArray = JSON.parse(finalJsonText); // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON

                // ‡∏•‡∏ö‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡∏≠‡∏≠‡∏Å
                if (responseArray.length > 1) {
                    responseArray.splice(1, 1); // ‡∏•‡∏ö‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á
                }

                console.log("‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏ö:", responseArray); // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏ö

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ result.data ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå
                responseArray.forEach(item => {
                    if (item.data && Array.isArray(item.data)) {
                        const auctionItems = item.data.filter(item => item && item.name && item.description && item.image && item.price); // ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

                        auctionItems.forEach(auctionItem => {
                            const auctionItemElement = document.createElement('div');
                            auctionItemElement.classList.add('auction-item');

                            auctionItemElement.innerHTML = `
                    <img src="${auctionItem.image}" style="height: 100px; width: 100px; margin-bottom:10px;" alt="${auctionItem.name}">
                    <div class="details">
                        <strong>${auctionItem.name}</strong>
                        <p>${auctionItem.description}</p>
                    </div>
                    <div style="font-weight:800;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: <span id="min-bid">${auctionItem.price}</span> ‡∏ö‡∏≤‡∏ó</div>
                `;

                            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
                            localStorage.setItem('img', auctionItem.image);
                            localStorage.setItem('name', auctionItem.name);
                            localStorage.setItem('bid', auctionItem.price);
                            localStorage.setItem('details', auctionItem.description);

                            // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô 'bid' ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                            const bidRef = ref(getdata, 'bid');  // ‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á 'bid' ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            onValue(bidRef, (snapshot) => {
                                const data = snapshot.val();

                                if (!data) {
                                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô bid ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•
                                    const bidButton = document.createElement('button');
                                    bidButton.classList.add('btn');
                                    bidButton.textContent = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•';
                                    bidButton.addEventListener('click', () => startAuction(auctionItem.price));

                                    auctionItemElement.appendChild(bidButton);
                                } else {
                                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô bid ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•
                                    console.log('‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô bid ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß');
                                }
                            });

                            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô DOM
                            document.querySelector('.auction').appendChild(auctionItemElement);
                        });
                    } else {
                        console.error("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:", result);
                    }

                });
            } catch (error) {
                console.error("Error loading auction items:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', async function () {

            localStorage.removeItem('userMoney');
            localStorage.removeItem('countUsers');
            localStorage.removeItem('img');
            localStorage.removeItem('name');
            localStorage.removeItem('bid');
            localStorage.removeItem('details');

            const usergmtemp = localStorage.getItem('userEmail');

            await loadAuctionItems(); // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•
            await clearBidData();
            await loadUsersData(usergmtemp);
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
            updateProfileModal();
            html = `‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°: ${countUsers} ‡∏Ñ‡∏ô`;
            const userCountDisplay = document.getElementById('userCountDisplay');
            userCountDisplay.textContent = html;
        });
        let userDatagm = [];
        async function loadUsersData(usergmtemp) {
            try {
                userDatagm = []; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô userDatagm ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤

                const querySnapshot = await getDocs(collection(db, 'usersgame'));
                querySnapshot.forEach((userDoc) => {
                    const userData = userDoc.data();
                    const { username, email, password, accoutpp, picture, created_at, money } = userData;
                    const id = userDoc.id;

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô usersData
                    if (usergmtemp && email === usergmtemp) {
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                        userDatagm.push({
                            username: username,
                            email: email,
                            password: password,
                            accoutpp: accoutpp,
                            picture: picture,
                            created_at: new Date(created_at.seconds * 1000 + created_at.nanoseconds / 1000000),
                            money: money,
                            id: id
                        });
                    }
                });

                if (usergmtemp && userDatagm.length === 0) {
                    console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô localStorage');
                } else {
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á money ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                    if (userDatagm.length > 0) {
                        let money = userDatagm[0].money;
                        userMoney = money;
                        //window.money = money; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ money ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á window
                        localStorage.setItem('userMoney', money);
                    }
                }
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', error);
            }
        }

        //‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à
        document.getElementById('save').addEventListener('click', async (event) => {
            event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö

            const newUsername = document.getElementById('usernamePreview').value; // ‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡πâ‡∏≠‡∏ô
            const selectedFile = document.getElementById('profilePicInput').files[0]; // ‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

            console.log("selectedFile:" + selectedFile);

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ userDatagm ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß
            if (userDatagm.length > 0) {
                const currentUserEmail = localStorage.getItem('userEmail');
                const userToUpdate = userDatagm.find(user => user.email === currentUserEmail);

                if (userToUpdate) {
                    console.log('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', userToUpdate);

                    if (selectedFile && selectedFile.name) {
                        if (selectedFile) {
                            console.log("Selected file:", selectedFile); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                        } else {
                            console.error("No file selected.");
                        }

                        if (!selectedFile.name || selectedFile.name.trim() === "") {
                            console.error("File name is invalid.");
                            return;
                        }
                        if (!storage) {
                            console.error("Firebase storage instance is not initialized.");
                            return;
                        }

                        const fileRef = storageRef(storage, `images/${selectedFile.name}`);


                        const uploadTask = uploadBytes(fileRef, selectedFile);


                        uploadTask.then(async (snapshot) => {
                            console.log('Uploaded file successfully');
                            const downloadURL = await getDownloadURL(snapshot.ref);
                            await updateProfilePicture(userToUpdate.id, downloadURL);
                            await updateUsername(userToUpdate.id, newUsername);
                            alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                        }).catch((error) => {
                            console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û:", error);
                        });

                    } else {
                        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û
                        await updateUsername(userToUpdate.id, newUsername);
                        alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                    }
                } else {
                    console.log("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö userEmail");
                }
            } else {
                console.log('‡πÇ‡∏õ‡∏£‡∏î‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
            }
        });

        async function uploadFile(selectedFile, userToUpdate, newUsername) {
            if (!selectedFile) {
                console.error("‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å");
                return;
            }

            const storage = getStorage();
            const fileRef = storageRef(storage, `images/${selectedFile.name}`);

            try {
                const snapshot = await uploadBytes(fileRef, selectedFile);
                console.log('Uploaded file successfully');

                const downloadURL = await getDownloadURL(snapshot.ref);
                await updateProfilePicture(userToUpdate.id, downloadURL);
                await updateUsername(userToUpdate.id, newUsername);
                alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
            } catch (error) {
                console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û:", error);
            }
        }

        // ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
        const handleFileUpload = (e) => {
            const selectedFile = e.target.files[0]; // ‡∏´‡∏≤‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            uploadFile(selectedFile, userToUpdate, newUsername);
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        document.getElementById('editProfileBtn').addEventListener('click', async () => {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå

            editProfileModal.style.display = 'block';
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.body.style.overflow = 'hidden'; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
            const usergmtemp = localStorage.getItem('userEmail');
            await loadUsersData(usergmtemp);
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
            updateProfileModal();
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        async function updateProfileModal() {
            const usergmtemp = localStorage.getItem('userEmail');
            const usernamePreviewInput = document.getElementById('usernamePreview');
            const profilePicPreview = document.getElementById('profilePicPreview');
            const userID = document.getElementById('userID');
            const date = document.getElementById('date');
            const email = document.getElementById('email');
            const nameU = document.getElementById('nameU');
            const picU = document.getElementById('picU');
            const money = document.getElementById('money');

            // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
            if (userDatagm.length > 0) {
                usernamePreviewInput.value = userDatagm[0].username;
                nameU.textContent = userDatagm[0].username;
                profilePicPreview.src = userDatagm[0].picture;
                picU.src = userDatagm[0].picture;
                userID.textContent = "uid : " + userDatagm[0].accoutpp;
                email.textContent = "email : " + userDatagm[0].email;
                date.textContent = "date : " + userDatagm[0].created_at.toLocaleString();
                money.textContent = userDatagm[0].money;

            } else {
                console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
            }
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        const editProfileModal = document.getElementById('editProfileModal');
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
        const closeButton = document.querySelector('.close');
        // ‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
        closeButton.addEventListener('click', () => {
            // ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
            editProfileModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        // ‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
        window.addEventListener('click', (event) => {
            if (event.target === editProfileModal) {
                // ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
                editProfileModal.style.display = 'none';
                // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥
                document.body.style.overflow = 'auto';
            }
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Firestore
        async function updateUsername(userId, newUsername) {
            const userRef = doc(db, 'usersgame', userId);
            try {
                await updateDoc(userRef, { username: newUsername });
                console.log('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', error);
                throw error;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï URL ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô Firestore
        async function updateProfilePicture(userId, downloadURL) {
            const userRef = doc(db, 'usersgame', userId);
            try {
                await updateDoc(userRef, { picture: downloadURL });
                console.log('URL ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå:', error);
                throw error;
            }
        }



        // ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
        const changeProfilePicBtn = document.getElementById('profilePicPreview');
        const profilePicInput = document.getElementById('profilePicInput');

        changeProfilePicBtn.addEventListener('click', () => {
            profilePicInput.click(); // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
        });

        window.onload = function () {
            var profilePicPreview = document.getElementById('profilePicPreview');

            if (profilePicPreview) {
                document.getElementById('profilePicInput').addEventListener('change', function (event) {
                    var reader = new FileReader();

                    reader.onload = function () {
                        if (profilePicPreview) {
                            profilePicPreview.src = reader.result;  // Set the preview image
                        } else {
                            console.error('profilePicPreview is null. Ensure the <img> element with id="profilePicPreview" exists in the HTML.');
                        }
                    };

                    reader.readAsDataURL(event.target.files[0]);  // Read the selected file
                });
            } else {
                console.error('profilePicPreview is null. Check if the element exists in the DOM.');
            }
        };

        document.getElementById('profilePicInput').addEventListener('change', function (event) {
            var reader = new FileReader();
            reader.onload = function () {
                var profilePicPreview = document.getElementById('profilePicPreview');
                if (profilePicPreview) {
                    profilePicPreview.src = reader.result;  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
                } else {
                    console.error('profilePicPreview is null. Ensure the <img> element with id="profilePicPreview" exists in the HTML.');
                }
            };
            reader.readAsDataURL(event.target.files[0]);  // ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        });















        let userMoney = 0;
        let moneyUser = true;
        let state_run = false;
        async function startAuction(minBid) {
            state_run = true;
            console.log("‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•");

            const userEmail = localStorage.getItem('userEmail');

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!userEmail || userEmail.trim() === "") {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'); // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                return;
            }

            localStorage.setItem('userMoney', userMoney);
            localStorage.setItem('countUsers', countUsers);

            console.log("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤:" + countUsers);
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ userEmail ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
            if (!userEmail || userEmail.trim() === "") {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                return;
            }

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            if (countUsers < 2) {/*************************   ‡∏ï‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 2  *****************************/
                alert("‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 1 ‡∏Ñ‡∏ô");
            } else if (userMoney < minBid) {
                moneyUser = false;
                alert("‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ö‡∏¥‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥"); // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠

            } else if (countUsers >= 2) {
                console.log("‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß");
                startCountdown(5); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
            }

            if (moneyUser) {
                checkAndPushEmail(userEmail);
            }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
        async function checkAndPushEmail(userEmail) {
            onValue(ref(getdata, 'countall'), (snapshot) => {
                const data = snapshot.val();
                let emailExists = false;

                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô snapshot
                if (data) {
                    // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    for (const key in data) {
                        if (data[key].user === userEmail) {
                            emailExists = true;
                            break;
                        }
                    }
                }

                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                if (!emailExists) {

                    set(push(ref(getdata, 'countall')), {
                        user: userEmail
                    });
                    console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                } else {
                    console.log('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß');
                }
            }, {
                onlyOnce: true  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ onValue ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            });
        }
        let html;
        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•
        document.addEventListener('DOMContentLoaded', async function () {
            const bb = localStorage.getItem('bid');
            let bid2 = parseInt(localStorage.getItem('bb'));


            // ‡∏î‡∏∂‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å localStorage
            const userEmail = localStorage.getItem('userEmail');


            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!userEmail || userEmail.trim() === "") {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'); // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                return;
            }

            onValue(ref(getdata, 'countall'), (snapshot) => {
                const data = snapshot.val();

                if (data) {
                    countUsers = Object.keys(data).length; // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô data (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö)
                    console.log(`‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${countUsers} ‡∏Ñ‡∏ô`);

                    // ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                    html = `‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°: ${countUsers} ‡∏Ñ‡∏ô ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ï‡πâ‡∏≠‡∏á2‡∏Ñ‡∏ô`;
                    localStorage.setItem('countUsers', countUsers);

                    const userCountDisplay = document.getElementById('userCountDisplay');
                    userCountDisplay.textContent = html;
                    if (state_run) {
                        startAuction(bid2);
                    }

                } else {
                    const userCountDisplay = document.getElementById('userCountDisplay');
                    userCountDisplay.textContent = html;
                    console.log('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô countall');
                    html = `‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°: ${countUsers} ‡∏Ñ‡∏ô`;
                    localStorage.setItem('countUsers', countUsers);

                }
            });



            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•
            function removeBidButtons() {
                const bidButtons = document.querySelectorAll('.btn');
                bidButtons.forEach(button => {
                    button.remove();
                });
            }
        });

        function startCountdown(seconds) {
            console.log("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤");
            const timerDisplay = document.getElementById('auction-timer');
            let timeLeft = seconds;

            const timer = setInterval(() => {
                if (timeLeft <= 0) {
                    console.log("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß");
                    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•
                    window.location.href = "auction-page.html";
                } else {
                    timerDisplay.innerHTML = `‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${timeLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                    timeLeft--;
                }
            }, 1000);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        async function loadUserInventory() {
            const userEmail = localStorage.getItem('userEmail');

            if (!userEmail || userEmail.trim() === "") {
                console.error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'); // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                return;
            }

            try {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Firestore ‡∏ï‡∏≤‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                const userQuery = query(collection(db, 'usersgame'), where('email', '==', userEmail));
                const querySnapshot = await getDocs(userQuery);

                if (querySnapshot.empty) {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                    return;
                }

                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏û‡∏ö
                let userData;
                querySnapshot.forEach((doc) => {
                    userData = doc.data(); // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                });

                const bagItems = userData.bag || []; // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å bag

                const inventoryDiv = document.getElementById('inventory-items');
                inventoryDiv.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡∏°‡πà

                // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const totalItems = bagItems.length;
                const totalItemsDiv = document.getElementById('total-items');
                totalItemsDiv.innerHTML = `<p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á: ${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>`;


                if (totalItems > 0) {
                    bagItems.forEach(item => {
                        const itemElement = document.createElement('div');
                        itemElement.classList.add('inventory-item');

                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ß‡∏•‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Timestamp
                        const itemDate = item.date && item.date.toDate
                            ? item.date.toDate().toLocaleString() // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
                            : item.date;

                        itemElement.innerHTML = `                       
                            <img src="${item.image}" style="height: 100px; width: 100px;" alt="${item.name}">
                            <div class="details">
                                <strong>${item.name}</strong>
                                <p>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${item.description}</p> 
                                <p>‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${itemDate}</p> 
                                <p>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ${item.price} ‡∏ö‡∏≤‡∏ó</p>
                                <p>‡∏õ‡∏£‡∏∞‡∏°‡∏π‡∏•‡∏à‡∏ö‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤: ${item.bid} ‡∏ö‡∏≤‡∏ó</p>
                            </div>                      
                        `;

                        inventoryDiv.appendChild(itemElement);
                    });
                } else {
                    inventoryDiv.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</p>';
                }
                return bagItems; // ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏≤‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á 
        async function loadShopAndCompareWithInventory() {
            const bagItems = await loadUserInventory(); // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            const userItemsNames = bagItems.map(item => item.name); // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ

            try {
                const querySnapshot = await getDocs(collection(db, 'products'));
                let allItems = [];

                querySnapshot.forEach((doc) => {
                    const productData = doc.data();
                    Object.keys(productData).forEach(key => {
                        const productArray = productData[key];

                        if (Array.isArray(productArray)) {
                            productArray.forEach((itemData) => {
                                allItems.push(itemData);
                            });
                        }
                    });
                });

                const shopContainer = document.getElementById('shop-items');
                const moreItemsContainer = document.getElementById('more-items');
                shopContainer.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
                moreItemsContainer.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

                allItems.forEach((itemData, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('shop-item');
                    itemElement.innerHTML = `
                <img src="${itemData.image}" alt="Item" style="height: 100px; width: 100px;" onclick="openModal('${itemData.image}')">
                <div class="details">
                    <strong style="font-size:larger; color:red;">${itemData.name}</strong>
                    <p>${itemData.description}</p>
                </div>
                <div>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠: ${itemData.sell} ‡∏ö‡∏≤‡∏ó</div>
            `;

                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (userItemsNames.includes(itemData.name)) {
                        const sellButton = document.createElement('button');
                        sellButton.classList.add('btn');
                        sellButton.textContent = '‡∏Ç‡∏≤‡∏¢';
                        sellButton.onclick = () => sellItem(itemData.name, itemData.sell); // ‡∏™‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≤‡∏¢
                        itemElement.appendChild(sellButton);
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏û‡∏≤‡∏∞ 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡πÉ‡∏ô shopContainer
                    if (index < 2) {
                        shopContainer.appendChild(itemElement);
                    } else {
                        moreItemsContainer.appendChild(itemElement); // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á moreItemsContainer
                    }
                });

                // ‡∏ã‡πà‡∏≠‡∏ô moreItemsContainer ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                moreItemsContainer.classList.add("hidden");
                if (moreItemsContainer.children.length > 0) {
                    moreItemsContainer.classList.remove("hidden"); // ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô moreItemsContainer
                }

                const usergmtemp = localStorage.getItem('userEmail');
                await loadUsersData(usergmtemp);
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                updateProfileModal();
            } catch (error) {
                console.error("Error getting documents: ", error);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        async function sellItem(itemName, price) {
            const userEmail = localStorage.getItem('userEmail');
            if (!userEmail || userEmail.trim() === "") {
                console.error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
                return;
            }

            try {
                // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•
                const userQuery = query(collection(db, 'usersgame'), where('email', '==', userEmail));
                const querySnapshot = await getDocs(userQuery);

                if (querySnapshot.empty) {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                    return;
                }

                let userDocId;
                let userData;

                querySnapshot.forEach((doc) => {
                    userDocId = doc.id;
                    userData = doc.data();
                });

                // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏¥‡πâ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö itemName ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                let updatedBag = [...userData.bag]; // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å bag ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                const itemIndex = updatedBag.findIndex(item => item.name === itemName);

                if (itemIndex !== -1) {
                    updatedBag.splice(itemIndex, 1); // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏¥‡πâ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å
                } else {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢');
                    return;
                }

                const updatedMoney = (userData.money || 0) + price; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢

                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Firestore
                await updateDoc(doc(db, 'usersgame', userDocId), {
                    bag: updatedBag,
                    money: updatedMoney
                });

                console.log(`‡∏Ç‡∏≤‡∏¢ ${itemName} ‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤ ${price} ‡∏ö‡∏≤‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                alert(`‡∏Ç‡∏≤‡∏¢ ${itemName} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° ${price} ‡∏ö‡∏≤‡∏ó`);

                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                await loadShopAndCompareWithInventory();
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:', error);
            }
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
        document.addEventListener('DOMContentLoaded', async function () {
            await loadShopAndCompareWithInventory(); // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            toggleItems();
        });
        function toggleItems() {
            const moreItems = document.getElementById("more-items");
            if (moreItems.classList.contains("hidden")) {
                moreItems.classList.remove("hidden");
            } else {
                moreItems.classList.add("hidden");
            }
        }

















        /************   ‡∏¢‡∏∑‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•   ************/
        async function fetchFromFirebase() {
            const querySnapshot = await getDocs(collection(db, 'products'));
            let firebaseProducts = [];

            querySnapshot.forEach((doc) => {
                const productData = doc.data();
                Object.keys(productData).forEach(key => {
                    const productArray = productData[key];
                    if (Array.isArray(productArray)) {
                        productArray.forEach((itemData) => {
                            firebaseProducts.push(itemData);
                        });
                    }
                });
            });

            return firebaseProducts;
        }

        async function fetchFromJSON() {
            const response = await fetch('products.json');
            const jsonData = await response.json();
            return jsonData;
        }

        async function updateProductsIfNeeded() {
            const firebaseProducts = await fetchFromFirebase();
            const jsonData = await fetchFromJSON();

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô firebasePd ‡πÅ‡∏•‡∏∞ jsonDt ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô json‡∏™‡∏ï‡∏£‡∏¥‡∏á‡πÄ‡∏û‡∏∑‡πà‡πÄ‡∏õ‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
            const firebaseProductsString = JSON.stringify(firebaseProducts);
            const jsonDataString = JSON.stringify(jsonData);

            if (firebaseProductsString !== jsonDataString) {
                console.log('‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô ‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');

                await updateJSONFile(firebaseProducts);
            } else {
                console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
            }
        }

        async function updateJSONFile(data) {
            const response = await fetch('updatedata.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                console.log('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } else {
                console.error('‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', response.statusText);
            }
        }

        document.addEventListener('DOMContentLoaded', async function () {
            await updateProductsIfNeeded();
        });

        document.getElementById('rankButton').addEventListener('click', async function () {
            const rankingTableContainer = document.getElementById('rankingTableContainer');
            const rankingTableBody = document.getElementById('rankingTable').querySelector('tbody');

            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firestore
                const querySnapshot = await getDocs(collection(db, 'usersgame'));
                let usersList = [];

                querySnapshot.forEach((userDoc) => {
                    const userData = userDoc.data();
                    const { username, picture, money } = userData;
                    usersList.push({
                        username: username,
                        picture: picture,
                        money: money
                    });
                });

                // ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
                usersList.sort((a, b) => b.money - a.money);

                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                rankingTableBody.innerHTML = '';

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                usersList.forEach((user, index) => {
                    const row = rankingTableBody.insertRow();

                    const rankCell = row.insertCell(0);
                    rankCell.textContent = index + 1;

                    const pictureCell = row.insertCell(1);
                    const img = document.createElement('img');
                    img.src = user.picture;
                    img.alt = 'Profile Picture';
                    img.width = 50; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û
                    pictureCell.appendChild(img);

                    const usernameCell = row.insertCell(2);
                    usernameCell.textContent = user.username;

                    const moneyCell = row.insertCell(3);
                    moneyCell.textContent = user.money;
                });

                // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
                rankingTableContainer.style.display = 'block';
            } catch (error) {
                console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:', error);
            }
        });












































    </script>
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</body>

</html>