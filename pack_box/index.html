<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Inventory Puzzle</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
      :root {
        --cell-size: 45px;
        --grid-gap: 2px;
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà */
        --bg-color: #1a1a2e;
        --panel-bg: rgba(30, 30, 30, 0.6); /* ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
        --border-color: rgba(255, 255, 255, 0.1);
        --highlight: #ffd700;
        --accent-red: #ff6b6b;
        --accent-green: #4ecdc4;
        --text-color: #f7f7f7;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--bg-color);
        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏™‡∏µ ‡∏ä‡∏°‡∏û‡∏π-‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡πà‡∏≠‡∏ô */
        background: radial-gradient(circle at top left, #2a2a72, #009ffd);
        background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: var(--text-color);
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        user-select: none;
        -webkit-user-select: none;
        overflow-x: hidden;
        position: relative;
      }

      /* Ambient Light Effects (‡∏•‡∏π‡∏Å‡πÅ‡∏™‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á) */
      .ambient-light {
        position: fixed;
        border-radius: 50%;
        filter: blur(80px);
        z-index: -1;
        opacity: 0.6;
      }
      .light-1 {
        width: 300px;
        height: 300px;
        background: #ff9a9e;
        top: -50px;
        left: -50px;
      }
      .light-2 {
        width: 400px;
        height: 400px;
        background: #a18cd1;
        bottom: -100px;
        right: -100px;
      }

      h1,
      h2,
      h3 {
        margin: 10px 0;
        color: #fff;
        text-align: center;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      /* --- Layout & Responsiveness --- */
      .game-wrapper {
        display: flex;
        flex-direction: column;
        width: 100%;
        max-width: 1000px;
        align-items: center;
        z-index: 1; /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
      }

      .game-container {
        display: flex;
        gap: 20px;
        padding: 20px;
        align-items: flex-start;
        flex-wrap: wrap;
        justify-content: center;
      }

      @media (max-width: 768px) {
        .game-container {
          flex-direction: column-reverse;
          align-items: center;
          gap: 10px;
          padding: 5px;
        }
        :root {
          --cell-size: 38px;
        }
        .shop-list {
          width: 100% !important;
          max-height: 200px !important;
          flex-direction: row;
          overflow-x: auto;
        }
      }

      /* --- Panels (Glassmorphism) --- */
      .panel {
        background: var(--panel-bg);
        backdrop-filter: blur(10px); /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏ù‡πâ‡∏≤ */
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      }

      .panel-title {
        margin-bottom: 10px;
        font-weight: bold;
        color: #ddd;
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 1px;
      }

      /* --- Grid & Items --- */
      .grid-frame {
        position: relative;
        background: rgba(0, 0, 0, 0.5);
        padding: 5px;
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 4px;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(9, var(--cell-size));
        grid-template-rows: repeat(6, var(--cell-size));
        gap: var(--grid-gap);
      }

      .cell {
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        width: var(--cell-size);
        height: var(--cell-size);
        box-sizing: border-box;
      }

      /* Shop */
      .shop-container {
        position: relative;
        border-radius: 4px;
        overflow: hidden;
      }

      .shop-list {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        width: 320px;
        max-height: 600px;
        overflow-y: auto;
        justify-content: flex-start;
        align-content: flex-start;
        padding: 5px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 4px;
        transition: filter 0.3s;
      }

      /* Shop Locked State */
      .shop-locked {
        filter: blur(8px);
        pointer-events: none;
      }

      .shop-overlay-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        z-index: 10;
        text-align: center;
        display: none;
        width: 100%;
      }

      /* Item Styling */
      .item {
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-sizing: border-box;
        cursor: grab;
        display: flex;
        justify-content: flex-start;
        align-items: flex-start;
        font-size: 0.8rem;
        color: white;
        transition: transform 0.1s;
        z-index: 10;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .price-tag {
        padding: 4px;
        font-weight: bold;
        font-size: 0.75rem;
        color: #fff;
        text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000,
          1px 1px 0 #000, 2px 2px 2px rgba(0, 0, 0, 0.8);
        pointer-events: none;
      }

      .item:active {
        cursor: grabbing;
        transform: scale(1.05);
        z-index: 100;
      }

      .placed {
        position: absolute;
        z-index: 5;
        cursor: grab;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.7);
      }
      .placed:active {
        cursor: grabbing;
      }

      .ghost {
        position: absolute;
        background: rgba(0, 255, 0, 0.3);
        border: 2px dashed #0f0;
        pointer-events: none;
        z-index: 20;
        transition: all 0.05s ease;
      }
      .ghost.invalid {
        background: rgba(255, 0, 0, 0.3);
        border-color: #f00;
      }

      /* HUD */
      .hud {
        display: flex;
        gap: 20px;
        margin-top: 15px;
        font-size: 1.1rem;
        background: rgba(30, 30, 30, 0.8);
        backdrop-filter: blur(5px);
        padding: 10px 30px;
        border-radius: 50px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 50;
        align-items: center;
      }
      .hud span {
        font-weight: bold;
        color: var(--highlight);
      }

      /* Buttons */
      button {
        background: #444;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 1rem;
        margin-top: 10px;
        border-radius: 8px;
        transition: all 0.2s;
        font-weight: bold;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      }
      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
      }
      button:active {
        transform: translateY(0);
      }

      .btn-green {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        color: #004d40;
      }
      .btn-red {
        background: linear-gradient(
          135deg,
          #ff9a9e 0%,
          #fecfef 99%,
          #fecfef 100%
        );
        color: #880e4f;
      }
      .btn-blue {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .btn-start {
        background: linear-gradient(135deg, #ffd200 0%, #f7971e 100%);
        color: #333;
        margin: 0;
        padding: 8px 16px;
        margin-left: 15px;
      }

      .btn-small {
        padding: 5px 10px;
        font-size: 0.8rem;
        margin-top: 5px;
      }
      .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: transparent;
        font-size: 1.5rem;
        color: #888;
        padding: 0;
        box-shadow: none;
      }
      .close-btn:hover {
        color: #fff;
        background: transparent;
        transform: none;
      }

      /* --- Creator Widget (New Feature) --- */
      .creator-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        align-items: flex-end;
      }
      .creator-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 3px solid #fff;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: transform 0.3s;
        /* ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏£‡∏á‡∏Å‡∏•‡∏° Default */
        background-image: url('me.jpg');
        background-size: cover;
      }
      .creator-avatar:hover {
        transform: scale(1.1) rotate(5deg);
      }

      .creator-bubble {
        background: white;
        color: #333;
        padding: 15px;
        border-radius: 15px;
        border-bottom-right-radius: 0;
        margin-bottom: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        font-size: 0.9rem;
        display: none; /* Hide initially */
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        max-width: 200px;
        text-align: center;
      }
      /* Show bubble on hover of container */
      .creator-widget:hover .creator-bubble {
        display: block;
      }

      .creator-socials {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
      }
      .social-icon {
        width: 24px;
        height: 24px;
        cursor: pointer;
        fill: #555;
        transition: fill 0.2s;
      }
      .social-icon:hover {
        fill: var(--accent-red);
      }

      @keyframes popIn {
        from {
          opacity: 0;
          transform: scale(0.5) translateY(20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      /* --- Modals & Pages --- */
      .full-screen-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(5px);
        z-index: 999;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        overflow-y: auto;
        padding: 20px;
      }

      .modal-content {
        background: #2a2a2a;
        background: linear-gradient(to bottom, #323232, #1a1a1a);
        padding: 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
        max-width: 800px;
        width: 95%;
        margin-top: 50px;
        position: relative;
        border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      }

      /* --- History Section --- */
      #historyList {
        width: 100%;
        max-width: 800px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 50px;
      }
      .history-card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 10px;
        flex-wrap: wrap;
      }
      .date-badge {
        background: #444;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
      }
      .daily-max {
        color: var(--highlight);
        font-size: 0.9rem;
        margin-left: 10px;
      }

      .visual-comparison {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .mini-grid-container {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .mini-grid-label {
        font-size: 0.8rem;
        color: #aaa;
        margin-bottom: 5px;
      }

      .mini-grid-wrapper {
        position: relative;
        background: #000;
        border: 1px solid #555;
      }
      .mini-item {
        position: absolute;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-sizing: border-box;
        display: flex;
        justify-content: flex-start;
        align-items: flex-start;
        color: white;
        overflow: hidden;
      }
      .mini-item .price-tag {
        font-size: 0.6rem;
        padding: 2px;
      }

      /* Result Score Box */
      .score-comparison {
        display: flex;
        justify-content: space-around;
        gap: 20px;
        margin: 20px 0;
      }
      .score-box {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        width: 140px;
      }
      .big-percent {
        font-size: 3rem;
        color: var(--highlight);
        margin: 10px 0;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      }

      /* --- Snapshot Hidden Area --- */
      #snapshotArea {
        position: absolute;
        top: -9999px;
        left: -9999px;
        background: linear-gradient(135deg, #1e1e2f, #252540);
        padding: 40px;
        border: 5px solid #333;
        width: 900px;
        display: flex;
        flex-direction: column;
        align-items: center;
        color: white;
        font-family: 'Segoe UI', sans-serif;
      }
      .snapshot-header {
        font-size: 2rem;
        margin-bottom: 20px;
        color: var(--highlight);
      }
      .snapshot-stats {
        display: flex;
        gap: 40px;
        margin-bottom: 30px;
        font-size: 1.5rem;
      }
      .snapshot-grids {
        display: flex;
        gap: 50px;
      }
      .snapshot-col {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .snapshot-col h3 {
        font-size: 1.5rem;
        margin-bottom: 15px;
      }

      .snapshot-footer {
        margin-top: 30px;
        font-size: 1.2rem;
        color: #aaa;
        border-top: 1px solid #555;
        padding-top: 10px;
        width: 100%;
        text-align: center;
      }

      /* ‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô (‡∏•‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) */
      .tutorial-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #ffd200 0%, #f7971e 100%);
        color: #333;
        border: 3px solid #fff;
        border-radius: 50%;
        font-size: 1.8rem;
        font-weight: bold;
        cursor: pointer;
        z-index: 2000; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠ */
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
        transition: transform 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .tutorial-btn:hover {
        transform: scale(1.1) rotate(10deg);
      }

      /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á List ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏ô */
      .tutorial-list {
        text-align: left;
        margin: 20px auto;
        max-width: 500px;
        line-height: 1.6;
        color: #ddd;
      }
      .tutorial-list li {
        margin-bottom: 10px;
      }
      .key-highlight {
        color: var(--highlight);
        font-weight: bold;
        background: rgba(255, 215, 0, 0.1);
        padding: 0 5px;
        border-radius: 4px;
      }
      @media (max-width: 768px) {
        /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô‡∏•‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á (50px -> 25px) */
        .tutorial-btn {
          width: 15px;
          height: 45px;
         font-size: 100;
          top: 65px;      /* ‡∏Ç‡∏¢‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
          left: 10px;
          border-width: 2px; /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏ö‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏™‡πà‡∏ß‡∏ô */
        }

        /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á (60px -> 30px) */
        .creator-avatar {
          width: 45px;
          height: 45px;
          border-width: 2px;
        }
        
        /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Widget ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏°‡∏∏‡∏°‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        .creator-widget {
          bottom: 10px;
          right: 10px;
        }
        
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏• */
        .creator-bubble {
            font-size: 0.75rem;
            padding: 10px;
            max-width: 150px;
        }
      }
    </style>
  </head>
  <body>
    <div class="ambient-light light-1"></div>
    <div class="ambient-light light-2"></div>
    <button class="tutorial-btn" onclick="openTutorial()">?</button>

    <div
      id="tutorialModal"
      class="full-screen-overlay"
      style="justify-content: center; z-index: 3000"
    >
      <div class="modal-content" style="max-width: 600px">
        <button class="close-btn" onclick="closeTutorial()">‚úï</button>
        <h2 style="color: var(--highlight); font-size: 2rem">
          ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏•‡πà‡∏ô (‡πÄ‡∏Å‡∏°‡∏™‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡πÄ‡∏Ñ‡πà‡∏ö‡∏ô‡∏Ñ‡∏≠‡∏° ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!!!)
        </h2>
        <hr style="border-color: rgba(255, 255, 255, 0.1); margin: 20px 0" />

        <div class="tutorial-list">
          <ul>
            <li>
              ‚è±Ô∏è
              <strong>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°:</strong>
              ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
              <span class="key-highlight">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤</span>
              ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤ 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
            </li>
            <li>
              üéí
              <strong>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong>
              ‡∏•‡∏≤‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ
              <span class="key-highlight">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
            </li>
            <li>
              üñ±Ô∏è
              <strong>‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡∏Ç‡∏≠‡∏á:</strong>
              ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≤‡∏Å‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
            </li>
            <li>
              ‚ùå
              <strong>‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡∏≠‡∏á:</strong>
              <span class="key-highlight">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤</span>
              ‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å (‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
            </li>
            <li>
              ü§ñ
              <strong>‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á:</strong>
              ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏™‡πà‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏±‡∏ö
              <strong>AI Greedy</strong>
              ‡∏î‡∏π‡∏ã‡∏¥‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡πâ‡∏≠‡∏á AI ‡∏°‡∏∞
            </li>
          </ul>
        </div>

        <div style="margin-top: 20px; font-size: 0.9rem; color: #aaa">
          ‡∏ó‡∏£‡∏¥‡∏Ñ: ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏¢‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÅ‡∏ó‡∏£‡∏Å‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
        </div>

        <button
          class="btn-green"
          style="margin-top: 30px; font-size: 1.2rem"
          onclick="closeTutorial()"
        >
          ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢
        </button>
      </div>
    </div>
    <div class="creator-widget">
      <div class="creator-bubble">
        <strong>‡∏ú‡∏°‡∏õ‡∏±‡∏á‡∏õ‡∏≠‡∏ô‡∏î‡πå‡∏ú‡∏π‡πâ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å</strong>
        <br />
        ‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏à‡πâ‡∏≤
        <div class="creator-socials">
          <a href="https://github.com/pp300950" target="_blank" title="GitHub">
            <svg class="social-icon" viewBox="0 0 24 24">
              <path
                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
              />
            </svg>
          </a>
          <a
            href="https://web.facebook.com/profile.php?id=61584509074271"
            target="_blank"
            title="Facebook"
          >
            <svg class="social-icon" viewBox="0 0 24 24">
              <path
                d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"
              />
            </svg>
          </a>
        </div>
      </div>
      <div class="creator-avatar"></div>
    </div>

    <div class="hud">
      <div>
        ‡πÄ‡∏ß‡∏•‡∏≤:
        <span id="timer">60</span>
        s
      </div>
      <div>
        ‡πÄ‡∏á‡∏¥‡∏ô:
        <span id="currentScore">0</span>
        ‡∏ø
      </div>
      <button id="startGameBtn" class="btn-start" onclick="startGame()">
        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
      </button>
    </div>

    <div class="game-wrapper" id="gamePage">
      <div class="game-container">
        <div class="panel">
          <div class="panel-title">‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á</div>
          <div class="shop-container">
            <div class="shop-overlay-text" id="shopOverlayText">
              ‡∏Å‡∏î "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
            </div>
            <div class="shop-list shop-locked" id="shop"></div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</div>
          <div class="grid-frame" id="gridFrame">
            <div class="grid" id="bgGrid"></div>
            <div id="placedItemsContainer"></div>
            <div id="ghost" class="ghost" style="display: none"></div>
          </div>
          <button
            id="submitBtn"
            class="btn-green"
            onclick="endGame()"
            style="display: none"
          >
            ‡∏™‡πà‡∏á‡πÄ‡∏•‡∏¢!
          </button>
        </div>
      </div>
      <div style="margin-top: 20px">
        <button class="btn-blue" onclick="showHistoryPage()">
          ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
        </button>
      </div>
    </div>

    <div
      id="resultModal"
      class="full-screen-overlay"
      style="justify-content: center"
    >
      <div class="modal-content">
        <button class="close-btn" onclick="closeResultToHistory()">‚úï</button>
        <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏á‡∏≤‡∏ô</h2>
        <div class="score-comparison">
          <div class="score-box">
            <div>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>
            <div
              style="font-size: 1.5rem; color: var(--accent-green)"
              id="finalPlayerScore"
            >
              0
            </div>
          </div>
          <div class="score-box">
            <div>AI (Greedy)</div>
            <div
              style="font-size: 1.5rem; color: var(--accent-red)"
              id="finalGreedyScore"
            >
              0
            </div>
          </div>
        </div>

        <div>‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
        <div class="big-percent" id="finalPercent">0%</div>

        <h3>‡∏ô‡πâ‡∏≠‡∏á AI ‡∏à‡∏±‡∏î‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ (‡∏£‡∏π‡∏õ‡πÄ‡πÄ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î):</h3>
        <div
          id="greedyResultContainer"
          style="display: inline-block; margin-bottom: 20px"
        ></div>

        <div
          style="
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
          "
        >
          <button class="btn-blue" onclick="takeSnapshot()">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</button>
          <button class="btn-red" onclick="closeResultToHistory()">
            ‡∏õ‡∏¥‡∏î (‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥)
          </button>
        </div>
      </div>
    </div>

    <div
      id="historyPage"
      class="full-screen-overlay"
      style="background: #121212"
    >
      <div
        style="
          width: 100%;
          max-width: 800px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: 20px;
          padding: 0 10px;
        "
      >
        <h1>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h1>
        <button onclick="hideHistoryPage()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Å‡∏°</button>
      </div>

      <div style="margin: 10px 0">
        <button class="btn-red btn-small" onclick="clearAllHistory()">
          ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>
      </div>

      <div id="historyList"></div>
    </div>

    <div id="snapshotArea">
      <div class="snapshot-header">‡∏à‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡πÄ‡∏™‡∏ô‡∏™‡∏ô‡∏∏‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
      <div class="snapshot-stats">
        <div>
          <span style="color: var(--accent-green)">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</span>
          <span id="snapPlayerScore">0</span>
        </div>
        <div>
          <span style="color: var(--accent-red)">‡∏ô‡πâ‡∏≠‡∏á AI:</span>
          <span id="snapAiScore">0</span>
        </div>
        <div>
          ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û:
          <span style="color: var(--highlight)" id="snapPercent">0%</span>
        </div>
      </div>
      <div class="snapshot-grids">
        <div class="snapshot-col">
          <h3>‡∏ù‡∏±‡πà‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h3>
          <div id="snapPlayerGrid"></div>
        </div>
        <div class="snapshot-col">
          <h3>‡∏ù‡∏±‡πà‡∏á Greedy AI</h3>
          <div id="snapAiGrid"></div>
        </div>
      </div>
      <div style="margin-top: 20px; color: #aaa">
        Date:
        <span id="snapDate"></span>
      </div>
      <div
        class="snapshot-footer"
        style="
          display: inline-block;
          padding: 10px 20px;
          margin-top: 20px;
          background: linear-gradient(135deg, #1a1a1a 0%, #333333 100%);
          color: #ffd700;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          font-size: 14px;
          font-weight: bold;
          text-decoration: none;
          border: 2px solid #ffd700;
          border-radius: 8px;
          box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
          letter-spacing: 1px;
          transition: all 0.3s ease;
          cursor: pointer;
        "
      >
        <span style="margin-right: 8px">üîó</span>
        https://pp300950.github.io/pack_box/index.html
      </div>
    </div>

    <script>
      // --- Config ---
      const COLS = 9;
      const ROWS = 6;
      const CELL_SIZE = 45;
      const GRID_GAP = 2;
      const HISTORY_KEY = 'inventory_puzzle_history';

      // --- Item Database ---
      const itemTypes = [
        { name: 'Gold Bar', w: 1, h: 1, min: 80, max: 200, color: '#FFD700' }, // ‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥
        { name: 'Silver', w: 1, h: 1, min: 100, max: 600, color: '#E0E0E0' }, // ‡∏™‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏ß‡πà‡∏≤‡∏á
        { name: 'Bottle', w: 1, h: 2, min: 240, max: 950, color: '#81D4FA' }, // ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÉ‡∏™ (Water)
        { name: 'Ammo', w: 2, h: 1, min: 100, max: 400, color: '#6B8E23' }, // ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ó‡∏´‡∏≤‡∏£ (OliveDrab)
        { name: 'Pistol', w: 2, h: 2, min: 230, max: 1000, color: '#546E7A' }, // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å (Blue Grey)
        { name: 'Rifle', w: 4, h: 2, min: 100, max: 2000, color: '#5D4037' }, // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏° (Dark Brown)
        { name: 'Medkit', w: 2, h: 2, min: 390, max: 700, color: '#EF5350' }, // ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•
        { name: 'Keycard', w: 1, h: 1, min: 5, max: 1800, color: '#26C6DA' }, // ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÄ‡∏ó‡∏≠‡∏£‡πå‡∏Ñ‡∏ß‡∏≠‡∏¢‡∏ã‡πå‡∏™‡∏ß‡πà‡∏≤‡∏á
        { name: 'Food', w: 2, h: 1, min: 50, max: 200, color: '#FF9800' }, // ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏™‡∏î‡πÉ‡∏™
        {
          name: 'Helicopter',
          w: 5,
          h: 5,
          min: 1000,
          max: 6000,
          color: '#37474F',
        }, // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏î‡∏≥ (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£)
        { name: 'Watermelon', w: 2, h: 5, min: 1, max: 1900, color: '#4CAF50' }, // ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÅ‡∏ï‡∏á‡πÇ‡∏°
        { name: 'Car', w: 4, h: 3, min: 500, max: 3050, color: '#EC407A' }, // ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡πÅ‡∏î‡∏á
        { name: 'Cat', w: 1, h: 3, min: 90, max: 450, color: '#B39DDB' }, // ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•
        { name: 'Dog', w: 1, h: 4, min: 1, max: 1900, color: '#D7CCC8' }, // ‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏≠‡πà‡∏≠‡∏ô
        { name: 'Armor', w: 3, h: 3, min: 100, max: 2500, color: '#1976D2' }, // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° (Safety Blue)
      ];

      // --- Helpers ---
      function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }
      function formatDate(date) {
        return new Date(date).toLocaleString('th-TH', {
          dateStyle: 'short',
          timeStyle: 'short',
        });
      }
      function getDayKey(dateString) {
        return new Date(dateString).toLocaleDateString();
      }

      // --- State Variables ---
      let availableItems = [];
      let gridState = Array(ROWS)
        .fill()
        .map(() => Array(COLS).fill(null));
      let playerScore = 0;
      let time = 60;
      let timerInterval;
      let isDragging = false;
      let currentDragItem = null;
      let currentDragEl = null;
      let lastGameData = null;
      let isGameStarted = false; // Check status

      // --- Game Logic ---

      function initGame() {
        // Reset State
        playerScore = 0;
        time = 60;
        gridState = Array(ROWS)
          .fill()
          .map(() => Array(COLS).fill(null));
        document.getElementById('currentScore').innerText = '0';
        document.getElementById('placedItemsContainer').innerHTML = '';
        document.getElementById('timer').innerText = time;
        document.getElementById('submitBtn').style.display = 'none';

        // Reset Start Button & Shop Lock
        isGameStarted = false;
        document.getElementById('startGameBtn').style.display = 'inline-block';
        document.getElementById('shop').classList.add('shop-locked');
        document.getElementById('shopOverlayText').style.display = 'block';

        generateLoot();
        renderGridBackground();
        renderShop();

        clearInterval(timerInterval);
        // *‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å startTimer() ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏£‡∏≠‡∏Ñ‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°*
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
      function startGame() {
        if (isGameStarted) return;
        isGameStarted = true;

        // Hide Button
        document.getElementById('startGameBtn').style.display = 'none';

        // Unlock Shop
        document.getElementById('shop').classList.remove('shop-locked');
        document.getElementById('shopOverlayText').style.display = 'none';

        startTimer();
      }

      function generateLoot() {
        availableItems = [];
        const pool = [
          { typeIdx: 6, count: 2 },
          { typeIdx: 0, count: 6 },
          { typeIdx: 4, count: 2 },
          { typeIdx: 3, count: 3 },
          { typeIdx: 8, count: 1 },
          { typeIdx: 5, count: 3 },
          { typeIdx: 2, count: 5 },
          { typeIdx: 1, count: 5 },
          { typeIdx: 7, count: 4 },
        ];

        let idCounter = 0;
        pool.forEach((p) => {
          const proto = itemTypes[p.typeIdx];
          for (let i = 0; i < p.count; i++) {
            availableItems.push({
              id: idCounter++,
              name: proto.name,
              w: proto.w,
              h: proto.h,
              val: randomInt(proto.min, proto.max),
              color: proto.color,
              placed: false,
              x: -1,
              y: -1,
            });
          }
        });
        availableItems.sort(() => Math.random() - 0.5);
      }

      function renderGridBackground() {
        const bg = document.getElementById('bgGrid');
        bg.innerHTML = '';
        for (let i = 0; i < COLS * ROWS; i++) {
          const d = document.createElement('div');
          d.className = 'cell';
          bg.appendChild(d);
        }
      }

      function renderShop() {
        const shop = document.getElementById('shop');
        shop.innerHTML = '';
        availableItems.forEach((item) => {
          if (item.placed) return;

          const wrapper = document.createElement('div');
          const scale = 30; // Scale for shop items
          wrapper.style.width = item.w * scale + 'px';
          wrapper.style.height = item.h * scale + 'px';
          wrapper.style.margin = '2px';

          const el = document.createElement('div');
          el.className = 'item';
          el.style.backgroundColor = item.color;
          el.style.width = item.w * scale + 'px';
          el.style.height = item.h * scale + 'px';
          el.innerHTML = `<span class="price-tag">${item.val}</span>`;

          el.onpointerdown = (e) => startDrag(e, item, el);

          wrapper.appendChild(el);
          shop.appendChild(wrapper);
        });
      }

      // --- Drag & Drop ---
      const ghost = document.getElementById('ghost');
      const gridFrame = document.getElementById('gridFrame');

      function startDrag(e, item, el) {
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏•‡∏≤‡∏Å‡πÑ‡∏î‡πâ
        if (time <= 0 || !isGameStarted) return;

        isDragging = true;
        currentDragItem = item;
        currentDragEl = el;
        el.setPointerCapture(e.pointerId);

        ghost.style.width = item.w * CELL_SIZE + (item.w - 1) * GRID_GAP + 'px';
        ghost.style.height =
          item.h * CELL_SIZE + (item.h - 1) * GRID_GAP + 'px';
        ghost.style.display = 'block';

        document.addEventListener('pointermove', onDrag);
        document.addEventListener('pointerup', endDrag);
      }

      function onDrag(e) {
        if (!isDragging) return;
        const rect = gridFrame.getBoundingClientRect();
        const rawX = e.clientX - rect.left;
        const rawY = e.clientY - rect.top;

        ghost.style.left = rawX + 'px';
        ghost.style.top = rawY + 'px';

        let gx = Math.floor(rawX / (CELL_SIZE + GRID_GAP));
        let gy = Math.floor(rawY / (CELL_SIZE + GRID_GAP));
        const snapX = gx * (CELL_SIZE + GRID_GAP) + 5;
        const snapY = gy * (CELL_SIZE + GRID_GAP) + 5;
        ghost.style.transform = `translate(${snapX - rawX}px, ${
          snapY - rawY
        }px)`;

        if (canPlace(gx, gy, currentDragItem.w, currentDragItem.h)) {
          ghost.classList.remove('invalid');
        } else {
          ghost.classList.add('invalid');
        }
      }

      function endDrag(e) {
        if (!isDragging) return;
        isDragging = false;
        document.removeEventListener('pointermove', onDrag);
        document.removeEventListener('pointerup', endDrag);
        ghost.style.display = 'none';

        const rect = gridFrame.getBoundingClientRect();
        const rawX = e.clientX - rect.left;
        const rawY = e.clientY - rect.top;
        let gx = Math.floor(rawX / (CELL_SIZE + GRID_GAP));
        let gy = Math.floor(rawY / (CELL_SIZE + GRID_GAP));

        if (canPlace(gx, gy, currentDragItem.w, currentDragItem.h)) {
          placeItem(gx, gy, currentDragItem);
        } else {
          renderShop();
        }
        currentDragItem = null;
      }

      function canPlace(x, y, w, h) {
        if (x < 0 || y < 0 || x + w > COLS || y + h > ROWS) return false;
        for (let r = y; r < y + h; r++) {
          for (let c = x; c < x + w; c++) {
            if (gridState[r][c] !== null) return false;
          }
        }
        return true;
      }

      function placeItem(x, y, item) {
        for (let r = y; r < y + item.h; r++) {
          for (let c = x; c < x + item.w; c++) {
            gridState[r][c] = item.id;
          }
        }

        const placedEl = document.createElement('div');
        placedEl.className = 'placed';
        placedEl.style.width =
          item.w * CELL_SIZE + (item.w - 1) * GRID_GAP + 'px';
        placedEl.style.height =
          item.h * CELL_SIZE + (item.h - 1) * GRID_GAP + 'px';
        placedEl.style.left = x * (CELL_SIZE + GRID_GAP) + 5 + 'px';
        placedEl.style.top = y * (CELL_SIZE + GRID_GAP) + 5 + 'px';
        placedEl.style.backgroundColor = item.color;
        placedEl.innerHTML = `<span class="price-tag">${item.val}</span>`;

        placedEl.oncontextmenu = (e) => {
          e.preventDefault();
          removeItem(x, y, item, placedEl);
        };
        placedEl.onpointerdown = (e) => {
          if (e.button !== 0) return;
          e.preventDefault();
          removeItem(x, y, item, placedEl);
          const dragProxy = document.createElement('div');
          document.body.appendChild(dragProxy);
          startDrag(e, item, dragProxy);
          setTimeout(() => dragProxy.remove(), 0);
        };

        document.getElementById('placedItemsContainer').appendChild(placedEl);
        document.getElementById('submitBtn').style.display = 'inline-block';

        playerScore += item.val;
        updateScoreDisplay();

        // Update item state
        const itemIndex = availableItems.findIndex((i) => i.id === item.id);
        if (itemIndex > -1) {
          availableItems[itemIndex].placed = true;
          availableItems[itemIndex].x = x;
          availableItems[itemIndex].y = y;
        }

        renderShop();
      }

      function removeItem(x, y, item, el) {
        if (time <= 0) return;
        for (let r = y; r < y + item.h; r++) {
          for (let c = x; c < x + item.w; c++) {
            gridState[r][c] = null;
          }
        }
        if (el) el.remove();
        const container = document.getElementById('placedItemsContainer');
        if (container.children.length === 0) {
          document.getElementById('submitBtn').style.display = 'none';
        }
        playerScore -= item.val;
        updateScoreDisplay();

        const itemIndex = availableItems.findIndex((i) => i.id === item.id);
        if (itemIndex > -1) {
          availableItems[itemIndex].placed = false;
          availableItems[itemIndex].x = -1;
          availableItems[itemIndex].y = -1;
        }
        renderShop();
      }

      function updateScoreDisplay() {
        document.getElementById('currentScore').innerText = playerScore;
      }

      function startTimer() {
        timerInterval = setInterval(() => {
          time--;
          document.getElementById('timer').innerText = time;
          if (time <= 0) {
            endGame();
          }
        }, 1000);
      }

      // --- AI Logic (Greedy Basic) ---
      function calculateGreedy() {
        let simGrid = Array(ROWS)
          .fill()
          .map(() => Array(COLS).fill(false));
        let aiScore = 0;
        let placedItems = [];

        // Clone items for calculation
        let allItems = availableItems.map((i) => ({ ...i }));
        // Sort by Density (Value / Area) then Size
        allItems.sort((a, b) => {
          let densityA = a.val / (a.w * a.h);
          let densityB = b.val / (b.w * b.h);
          if (densityB !== densityA) return densityB - densityA;
          return b.w * b.h - a.w * a.h;
        });

        for (let item of allItems) {
          let placed = false;
          for (let r = 0; r <= ROWS - item.h; r++) {
            for (let c = 0; c <= COLS - item.w; c++) {
              if (!placed && canPlaceInSim(simGrid, c, r, item.w, item.h)) {
                for (let y = r; y < r + item.h; y++) {
                  for (let x = c; x < c + item.w; x++) {
                    simGrid[y][x] = true;
                  }
                }
                aiScore += item.val;
                placedItems.push({ ...item, x: c, y: r });
                placed = true;
              }
            }
          }
        }
        return { score: aiScore, layout: placedItems };
      }

      // --- AI Logic (‡∏â‡∏•‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô: ‡∏•‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏´‡∏•‡∏≤‡∏¢‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î) ---
      /*
      function calculateGreedy() {
        let bestScore = -1;
        let bestLayout = [];
        
        // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ AI ‡∏•‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Ç‡∏≠‡∏á (‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏¢‡∏≠‡∏∞‡∏¢‡∏¥‡πà‡∏á‡∏â‡∏•‡∏≤‡∏î ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ä‡πâ‡∏≤‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å)
        // 500 ‡∏£‡∏≠‡∏ö ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö
        const iterations = 500; 

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á
        let baseItems = availableItems.map((i) => ({ ...i }));

        for (let i = 0; i < iterations; i++) {
            let currentItems = baseItems.map(item => ({ ...item }));
            
            // --- ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á AI ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≠‡∏ö ---
            if (i === 0) {
                // ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 1: ‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤ Density) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß
                currentItems.sort((a, b) => (b.val / (b.w * b.h)) - (a.val / (a.w * a.h)));
            } else if (i === 1) {
                // ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏û‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô (Value)
                currentItems.sort((a, b) => b.val - a.val);
            } else if (i === 2) {
                // ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô (Area) - ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡∏ó‡∏≤‡∏á‡∏û‡∏ß‡∏Å‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡∏•‡∏á
                currentItems.sort((a, b) => (b.w * b.h) - (a.w * a.h));
            } else {
                // ‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ‡∏™‡∏∏‡πà‡∏°‡∏°‡∏±‡πà‡∏ß‡πÄ‡∏•‡∏¢! (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ü‡∏•‡∏∏‡πä‡∏Ñ‡πÄ‡∏à‡∏≠‡∏ó‡πà‡∏≤‡πÑ‡∏°‡πâ‡∏ï‡∏≤‡∏¢)
                currentItems.sort(() => Math.random() - 0.5);
            }

            // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ---
            let simGrid = Array(ROWS).fill().map(() => Array(COLS).fill(false));
            let currentScore = 0;
            let currentLayout = [];

            for (let item of currentItems) {
                let placed = false;
                // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ß‡∏≤‡∏á‡πÑ‡∏•‡πà‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤ ‡∏ö‡∏ô‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á
                for (let r = 0; r <= ROWS - item.h; r++) {
                    if(placed) break;
                    for (let c = 0; c <= COLS - item.w; c++) {
                        if (canPlaceInSim(simGrid, c, r, item.w, item.h)) {
                            // ‡∏ß‡∏≤‡∏á‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á
                            for (let y = r; y < r + item.h; y++) {
                                for (let x = c; x < c + item.w; x++) {
                                    simGrid[y][x] = true;
                                }
                            }
                            currentScore += item.val;
                            currentLayout.push({ ...item, x: c, y: r });
                            placed = true;
                            break; 
                        }
                    }
                }
            }

            // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏à‡∏≥‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô "‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"
            if (currentScore > bestScore) {
                bestScore = currentScore;
                bestLayout = currentLayout;
            }
        }

        return { score: bestScore, layout: bestLayout };
      }
      */
      function canPlaceInSim(grid, x, y, w, h) {
        for (let r = y; r < y + h; r++) {
          for (let c = x; c < x + w; c++) {
            if (grid[r][c]) return false;
          }
        }
        return true;
      }

      // --- End Game & History ---
      function endGame() {
        clearInterval(timerInterval);
        const aiResult = calculateGreedy();

        // Stats
        let percent =
          aiResult.score > 0
            ? Math.round((playerScore / aiResult.score) * 100)
            : 0;

        // Prepare Data object for saving
        const gameData = {
          id: Date.now(),
          date: new Date().toISOString(),
          playerScore: playerScore,
          aiScore: aiResult.score,
          percent: percent,
          items: availableItems.map((i) => ({ ...i })), // Save current item state (incl. player pos)
          aiLayout: aiResult.layout,
        };
        lastGameData = gameData;

        // Save to LocalStorage
        saveHistory(gameData);

        // UI Update
        document.getElementById('finalPlayerScore').innerText = playerScore;
        document.getElementById('finalGreedyScore').innerText = aiResult.score;
        document.getElementById('finalPercent').innerText = percent + '%';

        // Draw Greedy Preview in Modal
        const greedyContainer = document.getElementById(
          'greedyResultContainer'
        );
        greedyContainer.innerHTML = '';
        renderMiniGrid(greedyContainer, aiResult.layout, 0.7);

        document.getElementById('resultModal').style.display = 'flex';
      }

      function saveHistory(data) {
        let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        history.unshift(data); // Add to top
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
      }

      function closeResultToHistory() {
        document.getElementById('resultModal').style.display = 'none';
        showHistoryPage();
      }

      // --- Rendering Mini Grids (Used in History & Snapshot) ---
      function renderMiniGrid(container, items, scaleFactor = 0.5) {
        const gCellSize = CELL_SIZE * scaleFactor;
        const width = COLS * gCellSize + (COLS - 1) * GRID_GAP;
        const height = ROWS * gCellSize + (ROWS - 1) * GRID_GAP;

        const wrapper = document.createElement('div');
        wrapper.className = 'mini-grid-wrapper';
        wrapper.style.width = width + 'px';
        wrapper.style.height = height + 'px';

        items.forEach((item) => {
          if (item.x === -1) return; // Not placed

          const el = document.createElement('div');
          el.className = 'mini-item';
          el.style.left = item.x * (gCellSize + GRID_GAP) + 'px';
          el.style.top = item.y * (gCellSize + GRID_GAP) + 'px';
          el.style.width = item.w * gCellSize + (item.w - 1) * GRID_GAP + 'px';
          el.style.height = item.h * gCellSize + (item.h - 1) * GRID_GAP + 'px';
          el.style.backgroundColor = item.color;
          el.innerHTML = `<span class="price-tag">${item.val}</span>`;
          wrapper.appendChild(el);
        });

        container.appendChild(wrapper);
      }

      // --- History Page Logic ---
      function showHistoryPage() {
        document.getElementById('gamePage').style.display = 'none';
        document.getElementById('historyPage').style.display = 'flex';
        renderHistoryList();
      }

      function hideHistoryPage() {
        document.getElementById('historyPage').style.display = 'none';
        document.getElementById('gamePage').style.display = 'flex';
        initGame(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏•‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
      }

      function renderHistoryList() {
        const list = document.getElementById('historyList');
        list.innerHTML = '';
        const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');

        if (history.length === 0) {
          list.innerHTML =
            '<div style="text-align:center; color:#aaa;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</div>';
          return;
        }

        // Calculate Max Score Per Day
        const dailyMax = {};
        history.forEach((h) => {
          const dKey = getDayKey(h.date);
          if (!dailyMax[dKey] || h.playerScore > dailyMax[dKey]) {
            dailyMax[dKey] = h.playerScore;
          }
        });

        history.forEach((game) => {
          const card = document.createElement('div');
          card.className = 'history-card';

          const dKey = getDayKey(game.date);
          const isMax = game.playerScore === dailyMax[dKey];

          let html = `
                <div class="history-header">
                    <div>
                        <span class="date-badge">${formatDate(game.date)}</span>
                        ${
                          isMax
                            ? '<span class="daily-max">üèÜ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô!</span>'
                            : ''
                        }
                    </div>
                    <div>
                        <span style="color:${
                          game.percent >= 80 ? 'var(--accent-green)' : '#aaa'
                        }">
                            Player: ${game.playerScore} (${game.percent}%)
                        </span> 
                        | <span style="color:var(--accent-red)">AI: ${
                          game.aiScore
                        }</span>
                    </div>
                </div>
                <div class="visual-comparison" id="vis-${game.id}"></div>
                <div style="display:flex; justify-content:flex-end; gap:10px;">
                    <button class="btn-blue btn-small" onclick="downloadSnapshotFromHistory(${
                      game.id
                    })">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ (PNG)</button>
                    <button class="btn-red btn-small" onclick="deleteHistoryItem(${
                      game.id
                    })">‡∏•‡∏ö</button>
                </div>
            `;
          card.innerHTML = html;
          list.appendChild(card);

          const visContainer = card.querySelector(`#vis-${game.id}`);

          const pDiv = document.createElement('div');
          pDiv.className = 'mini-grid-container';
          pDiv.innerHTML = '<div class="mini-grid-label">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>';
          const playerItems = game.items.filter((i) => i.placed);
          renderMiniGrid(pDiv, playerItems, 0.4);
          visContainer.appendChild(pDiv);

          const aDiv = document.createElement('div');
          aDiv.className = 'mini-grid-container';
          aDiv.innerHTML = '<div class="mini-grid-label">‡∏ô‡πâ‡∏≠‡∏á AI Greedy</div>';
          renderMiniGrid(aDiv, game.aiLayout, 0.4);
          visContainer.appendChild(aDiv);
        });
      }

      function deleteHistoryItem(id) {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ô‡∏µ‡πâ?')) return;
        let history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        history = history.filter((h) => h.id !== id);
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
        renderHistoryList();
      }

      function clearAllHistory() {
        if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return;
        localStorage.removeItem(HISTORY_KEY);
        renderHistoryList();
      }

      // --- Snapshot & Image Generation ---
      function prepareSnapshotDOM(gameData) {
        document.getElementById('snapPlayerScore').innerText =
          gameData.playerScore;
        document.getElementById('snapAiScore').innerText = gameData.aiScore;
        document.getElementById('snapPercent').innerText =
          gameData.percent + '%';
        document.getElementById('snapDate').innerText = formatDate(
          gameData.date
        );

        const pGrid = document.getElementById('snapPlayerGrid');
        const aGrid = document.getElementById('snapAiGrid');
        pGrid.innerHTML = '';
        aGrid.innerHTML = '';

        const playerItems = gameData.items.filter((i) => i.placed);
        renderMiniGrid(pGrid, playerItems, 0.8);
        renderMiniGrid(aGrid, gameData.aiLayout, 0.8);
      }

      function takeSnapshot() {
        if (!lastGameData) return;

        prepareSnapshotDOM(lastGameData);

        // Capture
        const element = document.getElementById('snapshotArea');
        html2canvas(element).then((canvas) => {
          const link = document.createElement('a');
          link.download = `inventory-result-${lastGameData.id}.png`;
          link.href = canvas.toDataURL();
          link.click();
        });
      }

      function downloadSnapshotFromHistory(id) {
        const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
        const gameData = history.find((h) => h.id === id);
        if (gameData) {
          prepareSnapshotDOM(gameData);
          const element = document.getElementById('snapshotArea');
          html2canvas(element).then((canvas) => {
            const link = document.createElement('a');
            link.download = `inventory-history-${id}.png`;
            link.href = canvas.toDataURL();
            link.click();
          });
        }
      }

      // --- Tutorial Logic ---
      function openTutorial() {
        document.getElementById('tutorialModal').style.display = 'flex';
      }

      function closeTutorial() {
        document.getElementById('tutorialModal').style.display = 'none';
      }

      // (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°) ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
      // ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤ comment ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö:

      /*
if (!localStorage.getItem('hasSeenTutorial')) {
    openTutorial();
    localStorage.setItem('hasSeenTutorial', 'true');
}
*/

      // Start
      initGame();
    </script>
  </body>
</html>
