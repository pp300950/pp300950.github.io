<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</title>

    <style>
        /* Basic Setup */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        h1, h2 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        hr {
            border: 0;
            height: 1px;
            background-color: #ecf0f1;
            margin: 20px 0;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* Important for width */
        }

        /* Buttons */
        .btn {
            display: inline-block;
            width: 100%;
            padding: 12px 15px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            box-sizing: border-box;
            margin-top: 10px;
        }

        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #bdc3c7;
            color: #333;
        }
        .btn-secondary:hover {
            background-color: #95a5a6;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
            width: auto; /* Smaller button */
            padding: 5px 10px;
            font-size: 14px;
        }

        .btn-vote {
            background-color: #2ecc71;
            color: white;
        }
        .btn-vote:hover {
            background-color: #27ae60;
        }

        .btn-abstain {
            background-color: #f39c12;
            color: white;
        }
        .btn-abstain:hover {
            background-color: #e67e22;
        }


        /* Candidate Setup List */
        .candidate-setup-item {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .candidate-setup-item .form-group {
            flex: 1;
            min-width: 150px;
            margin-bottom: 0;
        }
        .candidate-setup-item .image-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ccc;
            background-size: cover;
            background-position: center;
        }

        /* Voting Area */
        .vote-header {
            text-align: center;
            margin-bottom: 20px;
        }
        #timer-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #e74c3c;
        }
        #vote-count-display {
            font-size: 1.2em;
            color: #7f8c8d;
        }

        #voting-area {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .candidate-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .candidate-card img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #eee;
            margin-bottom: 10px;
        }
        .candidate-card h3 {
            margin: 10px 0 5px;
            color: #34495e;
        }
        .candidate-card p {
            margin: 0;
            font-size: 1.2em;
            font-weight: bold;
            color: #3498db;
        }

        /* Results Screen */
        #results-summary .result-item {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 5px solid #3498db;
        }
        #results-summary .result-item.winner {
            border-left-color: #2ecc71;
            background: #e8f8f5;
        }
        #results-summary h3 {
            margin-top: 0;
        }
        #results-summary .voter-list {
            font-size: 0.9em;
            color: #555;
            word-break: break-all;
        }

        /* Responsive Design */
        @media (min-width: 600px) {
            #voting-area {
                /* 2-column grid on larger screens */
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 800px) {
            #voting-area {
                /* 3-column grid on very large screens */
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="setup-screen">
            <h1>üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h1>
            
            <div class="form-group">
                <label for="total-voters">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏Ñ‡∏ô):</label>
                <input type="number" id="total-voters" min="1" value="10">
            </div>
            
            <div class="form-group">
                <label for="time-limit">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ):</label>
                <input type="number" id="time-limit" min="1" value="5">
            </div>

            <hr>
            
            <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h2>
            <div id="candidates-list">
                </div>
            <button id="add-candidate-btn" class="btn btn-secondary">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
            
            <hr>
            
            <button id="start-vote-btn" class="btn btn-primary">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
        </div>

        <div id="vote-screen" class="hidden">
            <div class="vote-header">
                <h2>‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h2>
                <div id="timer-display">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠: 05:00</div>
                <div id="vote-count-display">
                    <span id="votes-cast">0</span> / <span id="total-voters-display">10</span> ‡∏Ñ‡∏ô
                </div>
            </div>
            
            <div class="form-group">
                <label for="voter-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö):</label>
                <input type="text" id="voter-name" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...">
            </div>

            <div id="voting-area">
                </div>
            
            <button id="abstain-btn" class="btn btn-abstain">‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
        </div>

        <div id="results-screen" class="hidden">
            <h2>üèÜ ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
            <div id="results-summary"></div>
            <button id="restart-btn" class="btn btn-secondary">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    
            // State (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ)
            let candidates = [];
            let totalVoters = 0;
            let votesCast = 0;
            let abstainVotes = 0;
            let timeLimit = 0; // in seconds
            let timerInterval = null;
            let candidateIdCounter = 0;

            // DOM Elements (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö HTML)
            const setupScreen = document.getElementById('setup-screen');
            const voteScreen = document.getElementById('vote-screen');
            const resultsScreen = document.getElementById('results-screen');

            const totalVotersInput = document.getElementById('total-voters');
            const timeLimitInput = document.getElementById('time-limit');
            const addCandidateBtn = document.getElementById('add-candidate-btn');
            const candidatesList = document.getElementById('candidates-list');
            const startVoteBtn = document.getElementById('start-vote-btn');

            const timerDisplay = document.getElementById('timer-display');
            const votesCastDisplay = document.getElementById('votes-cast');
            const totalVotersDisplay = document.getElementById('total-voters-display');
            const voterNameInput = document.getElementById('voter-name');
            const votingArea = document.getElementById('voting-area');
            const abstainBtn = document.getElementById('abstain-btn');

            const resultsSummary = document.getElementById('results-summary');
            const restartBtn = document.getElementById('restart-btn');

            // --- 1. Setup Phase (‡∏ä‡πà‡∏ß‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤) ---

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
            addCandidateBtn.addEventListener('click', () => {
                candidateIdCounter++;
                const candidateId = `candidate-${candidateIdCounter}`;

                const item = document.createElement('div');
                item.className = 'candidate-setup-item';
                item.setAttribute('data-id', candidateId);

                item.innerHTML = `
                    <div class="image-preview" id="preview-${candidateId}"></div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå:</label>
                        <input type="text" class="candidate-number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1">
                    </div>
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</label>
                        <input type="text" class="candidate-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                    </div>
                    <div class="form-group">
                        <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
                        <input type="file" class="candidate-image" accept="image/*" data-preview="preview-${candidateId}">
                    </div>
                    <button class="btn btn-danger remove-candidate-btn">‡∏•‡∏ö</button>
                `;

                candidatesList.appendChild(item);

                // Handle image preview
                item.querySelector('.candidate-image').addEventListener('change', function(e) {
                    const previewId = this.getAttribute('data-preview');
                    const previewElement = document.getElementById(previewId);
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            previewElement.style.backgroundImage = `url(${event.target.result})`;
                        }
                        reader.readAsDataURL(file);
                    } else {
                        previewElement.style.backgroundImage = 'none';
                    }
                });

                // Handle remove button
                item.querySelector('.remove-candidate-btn').addEventListener('click', () => {
                    item.remove();
                });
            });

            // ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            startVoteBtn.addEventListener('click', () => {
                // 1. Collect candidate data
                candidates = [];
                const candidateItems = candidatesList.querySelectorAll('.candidate-setup-item');
                
                candidateItems.forEach(item => {
                    const number = item.querySelector('.candidate-number').value;
                    const name = item.querySelector('.candidate-name').value;
                    const imagePreview = item.querySelector('.image-preview').style.backgroundImage;
                    // ‡∏î‡∏∂‡∏á URL ‡∏à‡∏≤‡∏Å 'url("...")'
                    const imageUrl = imagePreview.slice(5, -2); 

                    if (number && name) {
                        candidates.push({
                            id: item.getAttribute('data-id'),
                            number: number,
                            name: name,
                            imageUrl: imageUrl || 'placeholder.png', // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏û default ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ
                            votes: 0,
                            voters: [] // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏ß‡∏ï‡πÉ‡∏´‡πâ
                        });
                    }
                });

                // 2. Get settings
                totalVoters = parseInt(totalVotersInput.value);
                timeLimit = parseInt(timeLimitInput.value) * 60; // ‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

                // 3. Validate
                if (candidates.length === 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô');
                    return;
                }
                if (totalVoters <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô');
                    return;
                }

                // 4. Start Voting
                setupScreen.classList.add('hidden');
                voteScreen.classList.remove('hidden');
                
                totalVotersDisplay.textContent = totalVoters;
                updateVoteCount();
                populateVotingArea();
                startTimer();
            });

            // --- 2. Voting Phase (‡∏ä‡πà‡∏ß‡∏á‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô) ---

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            function populateVotingArea() {
                votingArea.innerHTML = '';
                candidates.forEach(c => {
                    const card = document.createElement('div');
                    card.className = 'candidate-card';
                    card.innerHTML = `
                        <img src="${c.imageUrl}" alt="${c.name}">
                        <p>‡πÄ‡∏ö‡∏≠‡∏£‡πå ${c.number}</p>
                        <h3>${c.name}</h3>
                        <button class="btn btn-vote" data-id="${c.id}">‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ</button>
                    `;
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° Event Listener ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°
                    card.querySelector('.btn-vote').addEventListener('click', () => {
                        recordVote(c.id);
                    });
                    votingArea.appendChild(card);
                });
            }

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
            function startTimer() {
                updateTimerDisplay();
                timerInterval = setInterval(() => {
                    timeLimit--;
                    updateTimerDisplay();
                    if (timeLimit <= 0) {
                        endVoting('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤');
                    }
                }, 1000);
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏î‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
            function updateTimerDisplay() {
                const minutes = Math.floor(timeLimit / 60);
                const seconds = timeLimit % 60;
                timerDisplay.textContent = `‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÇ‡∏´‡∏ß‡∏ï
            function updateVoteCount() {
                votesCastDisplay.textContent = votesCast;
            }

            // ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            abstainBtn.addEventListener('click', () => {
                recordVote(null); // null ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            });

            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï
            function recordVote(candidateId) {
                let voterName = voterNameInput.value.trim(); // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÉ‡∏´‡∏°‡πà
                if (voterName === "") {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÄ‡∏£‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏ß‡∏ï‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥
                    // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ "‡∏ú‡∏π‡πâ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡∏Å‡∏ô‡∏≤‡∏°" ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏≠‡∏Å
                    voterName = `‡∏ú‡∏π‡πâ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏≠‡∏≠‡∏Å‡∏ô‡∏≤‡∏° #${votesCast + 1}`;
                }
                
                votesCast++;
                
                if (candidateId) {
                    // ‡πÇ‡∏´‡∏ß‡∏ï‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
                    const candidate = candidates.find(c => c.id === candidateId);
                    if (candidate) {
                        candidate.votes++;
                        candidate.voters.push(voterName);
                    }
                } else {
                    // ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                    abstainVotes++;
                }

                updateVoteCount();
                voterNameInput.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠
                
                // **‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á**
                if (votesCast >= totalVoters) {
                    endVoting('‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß');
                }
            }

            // --- 3. Results Phase (‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•) ---

            function endVoting(reason) {
                clearInterval(timerInterval); // ‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
                
                voteScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');
                
                displayResults(reason);
            }

            function displayResults(reason) {
                resultsSummary.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏Å‡πà‡∏≤

                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
                const sortedCandidates = [...candidates].sort((a, b) => b.votes - a.votes);
                const maxVotes = sortedCandidates.length > 0 ? sortedCandidates[0].votes : 0;

                resultsSummary.innerHTML += `<h3>‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${reason}</h3>`;
                resultsSummary.innerHTML += `<p><strong>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• (‡∏à‡∏≤‡∏Å ${votesCast} / ${totalVoters} ‡∏Ñ‡∏ô)</strong></p>`;

                sortedCandidates.forEach(c => {
                    const isWinner = c.votes > 0 && c.votes === maxVotes;
                    const winnerClass = isWinner ? 'winner' : '';
                    
                    resultsSummary.innerHTML += `
                        <div class="result-item ${winnerClass}">
                            <h3>${isWinner ? 'üèÜ' : ''} ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${c.number}: ${c.name}</h3>
                            <p><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${c.votes} ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</strong></p>
                            <p class="voter-list">
                                <strong>‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</strong> 
                                ${c.voters.length > 0 ? c.voters.join(', ') : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}
                            </p>
                        </div>
                    `;
                });

                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                resultsSummary.innerHTML += `
                    <div class="result-item">
                        <h3>‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                        <p><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${abstainVotes} ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</strong></p>
                    </div>
                `;
            }
            
            // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
            restartBtn.addEventListener('click', () => {
                // Reset state
                candidates = [];
                totalVoters = 0;
                votesCast = 0;
                abstainVotes = 0;
                timeLimit = 0;
                candidateIdCounter = 0;

                // Clear UI
                candidatesList.innerHTML = '';
                totalVotersInput.value = 10;
                timeLimitInput.value = 5;
                
                // Switch screens
                resultsScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');
            });

        });
    </script>

</body>
</html>

