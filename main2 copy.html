<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">‡∏ß‡∏±‡∏ô‡πÜ‡∏Ç‡∏≠‡∏á‡∏ú‡∏°</title>
   
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: 'Segoe UI', sans-serif;
        background-color: black;
        overflow: hidden;
      }

      #background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        overflow: hidden;
      }

      #background img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: opacity 1.5s ease-in-out;
        position: absolute;
        top: 0;
        left: 0;
      }

      #game {
        display: flex;
        flex-direction: column;
        height: 100vh;
        justify-content: flex-end;
      }

      #dialogue-box {
        background: rgba(49, 49, 49, 0.85);
        color: #f0f0f0;
        padding: 2rem;
        font-size: 1.5rem;
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        border-top: 4px solid #00bcd4;
        border-radius: 12px 12px 0 0;
        z-index: 2;
      }

      #choices {
        margin-top: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .choice,
      #next-btn {
        background: linear-gradient(to right, #00c6ff, #0072ff);
        color: white;
        padding: 0.75rem 1rem;
        border: none;
        font-size: 1.25rem;
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .choice:hover,
      #next-btn:hover {
        background: linear-gradient(to right, #0072ff, #00c6ff);
      }

      #name-input-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        z-index: 10;
      }

      #name-input-screen input,
      #name-input-screen button {
        font-size: 1.25rem;
        padding: 0.5rem 1rem;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <div id="background">
      <img id="background-img" src="Pic/rigis.jpeg" />
    </div>

    <div id="game">
      <div id="name-input-screen">
        <div>‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
        <input type="text" id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" />
        <button onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
      </div>

      <div id="dialogue-box">
        <button
          id="toggle-voice"
          onclick="toggleVoice()"
          style="
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 20;
            background: #222;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
          "
        >
          üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡∏õ‡∏¥‡∏î
        </button>

        <div
          id="dialogue-title"
          style="
            font-weight: bold;
            font-size: 1.8rem;
            color: rgb(236, 213, 111);
            text-shadow: -1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black,
              1px 1px 0 black;
            margin-bottom: 0.5rem;
          "
        ></div>
        <div id="dialogue-text"></div>
        <div id="choices"></div>
        <button id="next-btn" style="display: none" onclick="nextScene()">
          ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        </button>
      </div>
    </div>
    <script>
       let playerName = ''; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô
      const dialogueData = [
        {
          id: 'start',
          text: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÇ‡∏•‡∏Å‡πÅ‡∏´‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏à‡∏≤, {name} ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏û‡∏π‡∏î ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∞‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ä‡∏≤‡∏ï‡∏¥',
          background: 'Pic/checkhand.jpeg',
          choices: [],
        },
        {
          id: 'intro1',
          text: '‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏à‡∏£‡∏à‡∏≤ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡πà‡∏á ‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï!',
          background: 'Pic/present2.jpeg',
          choices: [],
        },
       
      ];

      let currentNode = null;
      let nextNodeId = null;
      let typingTimeouts = []; // ‡πÄ‡∏Å‡πá‡∏ö timeout IDs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå
      
      let voicesReady = false;
window.speechSynthesis.onvoiceschanged = () => {
  voicesReady = true;
};

      function startGame() {
        playerName =
          document.getElementById('playerName').value.trim() || '‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô';
        document.getElementById('name-input-screen').style.display = 'none';

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ test.jpeg
        const bg = document.getElementById('background');
        bg.innerHTML = ''; // ‡∏•‡∏ö‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
        const img = document.createElement('img');
        img.src = 'Pic/rigis.jpeg'; // ‡πÉ‡∏ä‡πâ test.jpeg ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover'; // ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
        bg.appendChild(img);
        document.title = `‡∏ß‡∏±‡∏ô‡πÜ‡∏Ç‡∏≠‡∏á ${playerName}`;
         // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input
         const inputElement = document.getElementById('playerName');
        playerName = inputElement.value.trim(); // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á

        if (playerName === '') {
          alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°');
          return;
        }

          // ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å interaction
  voiceEnabled = true;
  document.getElementById('toggle-voice').innerText = 'üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î';

        loadNode('start');
      }
      function typeText(element, text, speed = 30, name = '') {
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞ timeout ‡πÄ‡∏î‡∏¥‡∏°
        element.innerHTML = '';
        typingTimeouts.forEach(clearTimeout); // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        typingTimeouts = [];

        let i = 0;
        let rendered = '';

        function type() {
          if (i < text.length) {
            rendered += text[i];
            element.innerHTML = rendered.replace(
              '%%NAME%%',
              `<span style="color: yellow;">${name}</span>`
            );
            i++;
            const timeoutId = setTimeout(type, speed);
            typingTimeouts.push(timeoutId); // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
          }
        }

        type();
      }

      function fadeToBackground(newSrc) {
        const bg = document.getElementById('background');

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà
        const newImg = document.createElement('img');
        newImg.src = newSrc;
        newImg.style.width = '100%';
        newImg.style.height = '100%';
        newImg.style.objectFit = 'cover';
        newImg.style.opacity = '0';
        newImg.style.position = 'absolute';
        newImg.style.top = '0';
        newImg.style.left = '0';
        newImg.style.transition = 'opacity 1.5s ease-in-out';

        bg.appendChild(newImg); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ö‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤

        // ‡πÄ‡∏£‡∏¥‡πà‡∏° fade-in
        requestAnimationFrame(() => {
          newImg.style.opacity = '1';
        });

        // ‡∏•‡∏ö‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
        setTimeout(() => {
          const images = bg.querySelectorAll('img');
          if (images.length > 1) {
            bg.removeChild(images[0]); // ‡∏•‡∏ö‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
          }
        }, 1600); // ‡∏£‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ fade ‡∏Ñ‡∏£‡∏ö
      }

      function loadNode(id) {
        const node = dialogueData.find((n) => n.id === id);
        currentNode = node;
        nextNodeId = null;

        const rawText = node.text.replace('{name}', `%%NAME%%`);
        const dialogueElement = document.getElementById('dialogue-text');
        typeText(dialogueElement, rawText, 30, playerName);

        speakText(node.text.replace('{name}', playerName));


        const bg = document.getElementById('background');
        let safeBackground = node.background.replace(/\\/g, '/');

        fadeToBackground(safeBackground);

        const titleElement = document.getElementById('dialogue-title');
        if (node.title) {
          titleElement.innerText = node.title;
          titleElement.style.display = 'block';
        } else {
          titleElement.innerText = '';
          titleElement.style.display = 'none';
        }

        const choicesDiv = document.getElementById('choices');
        const nextBtn = document.getElementById('next-btn');
        choicesDiv.innerHTML = '';

        if (id === 'go-to-credits') {
          window.location.href = 'credits.html';
          return;
        }

        if (node.choices.length === 0) {
          //‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ" ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ next
          const index = dialogueData.findIndex((n) => n.id === id);
          const nextEntry = dialogueData[index + 1];
          if (nextEntry) {
            nextNodeId = nextEntry.id;
            nextBtn.style.display = 'block';
          } else {
            nextBtn.style.display = 'none';
          }
        } else {
          nextBtn.style.display = 'none';
          node.choices.forEach((choice) => {
            const btn = document.createElement('button');
            btn.className = 'choice';
            btn.innerText = choice.text;
            btn.onclick = () => loadNode(choice.next);
            choicesDiv.appendChild(btn);
          });
        }
      }

      function nextScene() {
        if (nextNodeId) {
          loadNode(nextNodeId);
        }
      }





      let voiceEnabled = false; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà

      function toggleVoice() {
  voiceEnabled = !voiceEnabled;
  const button = document.getElementById('toggle-voice');
  button.innerText = voiceEnabled ? 'üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡πÄ‡∏õ‡∏¥‡∏î' : 'üîá ‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ‡∏õ‡∏¥‡∏î';

  if (voiceEnabled) {
    speakText("‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß"); // ‚Üê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ô‡∏µ‡πâ
    if (currentNode) {
      speakText(currentNode.text.replace('{name}', playerName));
    }
  } else {
    window.speechSynthesis.cancel(); // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  }
}

function speakText(text) {
  if (!voiceEnabled) {
    console.log('‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà');
    return;
  }
  if (!voicesReady) {
    console.warn('‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°');
    return;
  }
  if (!voiceEnabled || !voicesReady) return;

  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'th-TH';
  utterance.rate = 1;
  utterance.pitch = 1;

  window.speechSynthesis.cancel(); // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡πà‡∏≠‡∏ô
  window.speechSynthesis.speak(utterance);
}


    </script>
  </body>
</html>
